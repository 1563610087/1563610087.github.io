<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1 数据 | UFO基地</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hello, my friend!">
    
    <link rel="preload" href="/assets/css/0.styles.d4bf95f4.css" as="style"><link rel="preload" href="/assets/js/app.ed392c7e.js" as="script"><link rel="preload" href="/assets/js/2.e61ebc2f.js" as="script"><link rel="preload" href="/assets/js/17.65a246fc.js" as="script"><link rel="prefetch" href="/assets/js/10.0c2a5e6f.js"><link rel="prefetch" href="/assets/js/11.65763309.js"><link rel="prefetch" href="/assets/js/12.62bd7cd5.js"><link rel="prefetch" href="/assets/js/13.84fd7b00.js"><link rel="prefetch" href="/assets/js/14.76172ee6.js"><link rel="prefetch" href="/assets/js/15.3ad856d8.js"><link rel="prefetch" href="/assets/js/16.3ac7f06b.js"><link rel="prefetch" href="/assets/js/18.cb772baf.js"><link rel="prefetch" href="/assets/js/19.f76cfbf3.js"><link rel="prefetch" href="/assets/js/20.dc8d8d82.js"><link rel="prefetch" href="/assets/js/21.687a969a.js"><link rel="prefetch" href="/assets/js/22.137fa288.js"><link rel="prefetch" href="/assets/js/23.14cbc642.js"><link rel="prefetch" href="/assets/js/24.0aeeb403.js"><link rel="prefetch" href="/assets/js/25.7fa9db84.js"><link rel="prefetch" href="/assets/js/26.44e82cd1.js"><link rel="prefetch" href="/assets/js/27.fa31f48f.js"><link rel="prefetch" href="/assets/js/28.8e011d93.js"><link rel="prefetch" href="/assets/js/29.ce077aa3.js"><link rel="prefetch" href="/assets/js/3.604382ba.js"><link rel="prefetch" href="/assets/js/30.79ecda02.js"><link rel="prefetch" href="/assets/js/31.ee3c01fc.js"><link rel="prefetch" href="/assets/js/32.c985f1e2.js"><link rel="prefetch" href="/assets/js/33.44200f11.js"><link rel="prefetch" href="/assets/js/34.c649ac18.js"><link rel="prefetch" href="/assets/js/35.2a6ddc50.js"><link rel="prefetch" href="/assets/js/36.bef21df1.js"><link rel="prefetch" href="/assets/js/37.01e1887e.js"><link rel="prefetch" href="/assets/js/38.6d4a1211.js"><link rel="prefetch" href="/assets/js/39.dde25747.js"><link rel="prefetch" href="/assets/js/4.b3d7061b.js"><link rel="prefetch" href="/assets/js/40.32c4bbff.js"><link rel="prefetch" href="/assets/js/41.da785b17.js"><link rel="prefetch" href="/assets/js/42.c3c277b4.js"><link rel="prefetch" href="/assets/js/5.abedb45c.js"><link rel="prefetch" href="/assets/js/6.73c063ed.js"><link rel="prefetch" href="/assets/js/7.b4e343ac.js"><link rel="prefetch" href="/assets/js/8.b05dfa12.js"><link rel="prefetch" href="/assets/js/9.823e2c0f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4bf95f4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">UFO基地</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/frontBase/html/htmlBase.html" class="nav-link">
  html
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontBase/css/cssBase.html" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontBase/javascript/string.html" class="nav-link">
  javascript
</a></li></ul></li><li class="dropdown-item"><h4>
          前端框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/vue/vueBase.html" class="nav-link">
  vue
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/react/reactBase.html" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/nodejs/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/webpack/webpack.html" class="nav-link">
  webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          web基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/webTech/browser/browser.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-subitem"><a href="/frontEnd/webTech/ajax/ajax.html" class="nav-link">
  ajax
</a></li><li class="dropdown-subitem"><a href="/frontEnd/webTech/http/http.html" class="nav-link">
  http
</a></li><li class="dropdown-subitem"><a href="/frontEnd/webTech/optimize/optimize.html" class="nav-link">
  性能优化
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/backEnd/" class="nav-link">
  后端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="通用" class="dropdown-title"><span class="title">通用</span> <span class="arrow down"></span></button> <button type="button" aria-label="通用" class="mobile-dropdown-title"><span class="title">通用</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/normal/github/gitNotes.html" class="nav-link">
  git文档
</a></li><li class="dropdown-item"><!----> <a href="/normal/algorithm/dataStructure.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/normal/nginx/nginx.html" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/normal/database/mysqlBase.html" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><h4>
          编辑器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/normal/editTool/idea/idea.html" class="nav-link">
  idea
</a></li><li class="dropdown-subitem"><a href="/normal/editTool/vscode/vscode.html" class="nav-link">
  vscode
</a></li><li class="dropdown-subitem"><a href="/normal/editTool/vim/vim.html" class="nav-link">
  vim
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构" class="dropdown-title"><span class="title">架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构" class="mobile-dropdown-title"><span class="title">架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端架构
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/frontFramework/webpack/webpack.html" class="nav-link">
  webpack
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/frontBase/html/htmlBase.html" class="nav-link">
  html
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontBase/css/cssBase.html" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontBase/javascript/string.html" class="nav-link">
  javascript
</a></li></ul></li><li class="dropdown-item"><h4>
          前端框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/vue/vueBase.html" class="nav-link">
  vue
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/react/reactBase.html" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/nodejs/nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frontFrame/webpack/webpack.html" class="nav-link">
  webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          web基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/webTech/browser/browser.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-subitem"><a href="/frontEnd/webTech/ajax/ajax.html" class="nav-link">
  ajax
</a></li><li class="dropdown-subitem"><a href="/frontEnd/webTech/http/http.html" class="nav-link">
  http
</a></li><li class="dropdown-subitem"><a href="/frontEnd/webTech/optimize/optimize.html" class="nav-link">
  性能优化
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/backEnd/" class="nav-link">
  后端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="通用" class="dropdown-title"><span class="title">通用</span> <span class="arrow down"></span></button> <button type="button" aria-label="通用" class="mobile-dropdown-title"><span class="title">通用</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/normal/github/gitNotes.html" class="nav-link">
  git文档
</a></li><li class="dropdown-item"><!----> <a href="/normal/algorithm/dataStructure.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/normal/nginx/nginx.html" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/normal/database/mysqlBase.html" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><h4>
          编辑器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/normal/editTool/idea/idea.html" class="nav-link">
  idea
</a></li><li class="dropdown-subitem"><a href="/normal/editTool/vscode/vscode.html" class="nav-link">
  vscode
</a></li><li class="dropdown-subitem"><a href="/normal/editTool/vim/vim.html" class="nav-link">
  vim
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构" class="dropdown-title"><span class="title">架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="架构" class="mobile-dropdown-title"><span class="title">架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端架构
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/frontFramework/webpack/webpack.html" class="nav-link">
  webpack
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/frontEnd/frontBase/javascript/string.html" class="sidebar-link">字符串</a></li><li><a href="/frontEnd/frontBase/javascript/array.html" class="sidebar-link">数组</a></li><li><a href="/frontEnd/frontBase/javascript/BOM_DOM.html" class="sidebar-link">BOM_DOM</a></li><li><a href="/frontEnd/frontBase/javascript/ES6Base.html" class="sidebar-link">ES6基础</a></li><li><a href="/frontEnd/frontBase/javascript/jsBase.html" class="sidebar-link">js基础</a></li><li><a href="/frontEnd/frontBase/javascript/jsAdvance.html" aria-current="page" class="active sidebar-link">js进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_1-数据" class="sidebar-link">1 数据</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_2-函数" class="sidebar-link">2 函数</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_3-对象" class="sidebar-link">3 对象</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_4-原型" class="sidebar-link">4 原型</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_5-继承" class="sidebar-link">5 继承</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_6-执行上下文" class="sidebar-link">6 执行上下文</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_7-作用域" class="sidebar-link">7 作用域</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_8-闭包" class="sidebar-link">8 闭包</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_9-内存溢出-内存泄露" class="sidebar-link">9 内存溢出-内存泄露</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_10-js运行机制" class="sidebar-link">10 js运行机制</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_11-javascript设计模式" class="sidebar-link">11 javascript设计模式</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_12-js实现多线程" class="sidebar-link">12 js实现多线程</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_13-深浅拷贝" class="sidebar-link">13 深浅拷贝</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frontBase/javascript/jsAdvance.html#_14-call-apply-bind" class="sidebar-link">14  call apply bind</a></li></ul></li><li><a href="/frontEnd/frontBase/javascript/jsModule.html" class="sidebar-link">模块机制</a></li><li><a href="/frontEnd/frontBase/javascript/jsDesignMode.html" class="sidebar-link">设计模式</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-数据"><a href="#_1-数据" class="header-anchor">#</a> 1 数据</h2> <h3 id="_1-数据类型分类"><a href="#_1-数据类型分类" class="header-anchor">#</a> 1 数据类型分类</h3> <ul><li>基本(值)类型
<ul><li>Number ----- 任意数值 -------- typeof</li> <li>String ----- 任意字符串 ------ typeof</li> <li>Boolean ---- true/false ----- typeof</li> <li>undefined --- undefined ----- typeof/===</li> <li>null -------- null ---------- ===</li></ul></li> <li>对象(引用)类型
<ul><li>Object ----- typeof/instanceof</li> <li>Array ------ instanceof</li> <li>Function ---- typeof</li> <li>RegExp</li></ul></li> <li>思考
<ol><li>undefined与null的区别?
<ul><li>undefined代表没有赋值</li> <li>null代表赋值了, 只是值为null， null用来表示尚未存在的对象</li></ul></li> <li>什么时候给变量赋值为null呢?
<ul><li>var a = null //a将指向一个对象, 但对象此时还没有确定</li> <li>a = null //让a指向的对象成为垃圾对</li></ul></li></ol></li></ul> <h3 id="_2-类型判断"><a href="#_2-类型判断" class="header-anchor">#</a> 2 类型判断</h3> <p>JavaScript 有四种方法，可以确定一个值到底是什么类型。</p> <ol><li><p>“===”</p> <ul><li>&quot;===&quot;全等运算符</li></ul></li> <li><p>typeof运算符</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">typeof</span>

<span class="token operator">-</span> 可以区别<span class="token operator">:</span> 数值<span class="token punctuation">,</span> 字符串<span class="token punctuation">,</span> 布尔值<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">function</span>
<span class="token operator">-</span> 不能区别<span class="token operator">:</span> <span class="token keyword">null</span>与对象<span class="token punctuation">,</span> 一般对象与数组

    <span class="token keyword">var</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">var</span> b<span class="token operator">=</span><span class="token punctuation">{</span>
      a<span class="token operator">:</span><span class="token number">1</span>
    <span class="token punctuation">}</span>   
    <span class="token keyword">var</span> c<span class="token operator">=</span><span class="token keyword">null</span>
    <span class="token keyword">var</span> <span class="token function-variable function">d</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">,</span><span class="token keyword">typeof</span> b<span class="token punctuation">,</span><span class="token keyword">typeof</span> c<span class="token punctuation">,</span><span class="token keyword">typeof</span> d<span class="token punctuation">)</span><span class="token comment">//object object object function</span>
</code></pre></div><ol start="3"><li>instanceof运算符</li></ol> <p>instanceof运算符用于测试构造函数的prototype属性是否出现在对象的原型链中的任何位置。专门用来判断对象数据的类型: Object, Array与Function</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span><span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token comment">//false</span>
<span class="token comment">//====================</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hah<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span><span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token comment">//true</span>
</code></pre></div><ol start="4"><li>Object.prototype.toString方法</li></ol> <ul><li>可以检查各种类型的数据</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;jerry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object String]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Number]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Boolean]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Undefined]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Null]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;jerry&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Object]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Function]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Array]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Date]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object RegExp]</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Object]</span>
</code></pre></div><p>toString为Object的原型方法，而<code>Array</code> ，function等类型作为Object的实例，都重写了toString方法。不同的对象类型调用toString方法时，根据原型链的知识，调用的是对应的重写之后的toString方法（function类型返回内容为函数体的字符串，Array类型返回元素组成的字符串.....），而不会去调用Object上原型toString方法（返回对象的具体类型），所以采用obj.toString()不能得到其对象类型，只能将obj转换为字符串类型；因此，在想要得到对象的具体类型时，应该调用Object上原型toString方法。</p> <p><strong>判断</strong></p> <p>数组：instanceOf  Object.prototype.toString  Array.isArray()</p> <p>对象：instanceOf  Object.prototype.toString</p> <p>函数：instanceOf  Object.prototype.toString</p> <h3 id="_3-类型转换"><a href="#_3-类型转换" class="header-anchor">#</a> 3 类型转换</h3> <h4 id="转换为数字"><a href="#转换为数字" class="header-anchor">#</a> 转换为数字</h4> <ul><li><p>Number()</p> <p><strong>(1)原始类型值</strong></p> <p>①字符串转数字</p> <p>Ⅰ 如果是纯数字的字符串，则直接将其转换为数字</p> <p>Ⅱ 如果字符串中有非数字的内容，则转换为NaN（NaN表示非数字的值）</p> <p>Ⅲ 如果字符串是一个空串或者是一个全是空格的字符串，则转换为0</p> <div class="language- extra-class"><pre class="language-text"><code>Number('324') // 324
Number('324abc') // NaN
Number('') // 0
//注意:number这个有问题，当数字较大时，出bug，最大值为16位，2的53次方，超过则不精确
var c='12630717197566440063'
var d=Number(c)
console.log(d)//12630717197566440000
</code></pre></div><p>②布尔值转数字:true转成1,false转成0</p> <div class="language- extra-class"><pre class="language-text"><code>Number(true) // 1
Number(false) // 0
</code></pre></div><p>③undefined转数字:转成NaN</p> <div class="language- extra-class"><pre class="language-text"><code>Number(undefined) // NaN
</code></pre></div><p>④null转数字：转成0</p> <div class="language- extra-class"><pre class="language-text"><code>Number(null) // 0
</code></pre></div><p>⑤Number() 接受数值作为参数，此时它既能识别负的十六进制，也能识别0开头的八进制，返回值永远是十进制值</p> <div class="language- extra-class"><pre class="language-text"><code>Number(3.15);    //3.15
Number(023);     //19
Number(0x12);    //18
Number(-0x12);   //-18
</code></pre></div><p><strong>(2)对象</strong></p> <p>简单的规则是，Number方法的参数是对象时，将返回NaN，除非是包含单个数值的数组。</p> <div class="language- extra-class"><pre class="language-text"><code>Number({a: 1}) // NaN
Number([1, 2, 3]) // NaN
Number([5]) // 5
</code></pre></div></li> <li><p>parseInt()</p> <div class="language- extra-class"><pre class="language-text"><code>var num1 = parseInt(&quot;12.3abc&quot;);  // 返回12，如果第一个字符是数字会解析知道遇到非数字结束
var num2 = parseInt(&quot;abc123&quot;);   // 返回NaN，如果第一个字符不是数字或者符号就返回NaN

该方法可以进行二进制转十进制
parseInt（二进制，2）
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//十进制转其他进制</span>
<span class="token keyword">var</span>  x <span class="token operator">=</span> <span class="token number">110</span><span class="token punctuation">;</span>
x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//转为2进制</span>
x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token comment">//转为8进制</span>
x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token comment">//转为16进制</span>
<span class="token comment">//其他进制转十进制</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">&quot;110&quot;</span><span class="token comment">//这是一个二进制的字符串表示</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//把这个字符串当做二进制， 转为十进制</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">&quot;70&quot;</span><span class="token comment">//这是一个八进制的字符串表示</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token comment">//把这个字符串当做八进制， 转为十进制</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token string">&quot;ff&quot;</span><span class="token comment">//这是一个十六进制的字符串表示</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token comment">//把这个字符串当做十六进制， 转为十进制</span>
</code></pre></div></li> <li><p>parseFloat()</p> <div class="language- extra-class"><pre class="language-text"><code>parseFloat()把字符串转换成浮点数
console.log(parseInt('.21'));        //NaN
console.log(parseInt(&quot;10.3&quot;));        //10
console.log(parseFloat('.21'));      //0.21
console.log(parseFloat('.d1'));       //NaN
console.log(parseFloat(&quot;10.11.33&quot;));  //10.11
console.log(parseFloat(&quot;4.3years&quot;));  //4.3
console.log(parseFloat(&quot;He40.3&quot;));    //NaN
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>parseInt逐个解析字符，而Number函数整体转换字符串的类型。
另外，对空字符串的处理也不一样
Number(&quot;   &quot;);     //0    
parseInt(&quot;   &quot;);   //NaN
</code></pre></div></li> <li><p>+，-0等运算</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'500'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 取正</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">-</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 取负</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str <span class="token operator">-</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="转换为字符串"><a href="#转换为字符串" class="header-anchor">#</a> 转换为字符串</h4> <ul><li><p>toString()</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//不能转null和undefined</span>
</code></pre></div><ul><li>采用 Number 类型的 toString() 方法的基模式，可以用不同的基输出数字，例如二进制的基是 2，八进制的基是 8，十六进制的基是 16</li></ul> <div class="language- extra-class"><pre class="language-text"><code>var iNum = 10;
alert(iNum.toString(2));        //输出 &quot;1010&quot;
alert(iNum.toString(8));        //输出 &quot;12&quot;
alert(iNum.toString(16));       //输出 &quot;A&quot;
</code></pre></div></li> <li><p>String()</p> <div class="language- extra-class"><pre class="language-text"><code>String()函数存在的意义：有些值没有toString()，这个时候可以使用String()。比如：undefined和null
</code></pre></div><ul><li>String方法的参数如果是对象，返回一个类型字符串；如果是数组，返回该数组的字符串形式。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>String<span class="token punctuation">(</span><span class="token punctuation">{</span>a: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> // <span class="token string">&quot;[object Object]&quot;</span>
String<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> // <span class="token string">&quot;1,2,3&quot;</span>
</code></pre></div></li> <li><p>拼接字符串方式</p> <p>num  +  &quot;&quot;，当 + 两边一个操作符是字符串类型，一个操作符是其它类型的时候，会先把其它类型转换成字符串再进行字符串拼接，返回字符串</p></li></ul> <h4 id="转换为boolean型"><a href="#转换为boolean型" class="header-anchor">#</a> 转换为boolean型</h4> <p>它的转换规则相对简单：<strong>只有空字符串(&quot;&quot;)、null、undefined、+0、-0 和 NaN 转为布尔型是 false，其他的都是 true，空数组、空对象转换为布尔类型也是 true,甚至连false对应的布尔对象new Boolean(false)也是true</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Boolean(undefined) // false
Boolean(null) // false
Boolean(0) // false
Boolean(NaN) // false
Boolean('') // false
Boolean({}) // true
Boolean([]) // true
Boolean(new Boolean(false)) // true
</code></pre></div><h3 id="_4-数据类型-存储"><a href="#_4-数据类型-存储" class="header-anchor">#</a> 4 数据类型---存储</h3> <p>JS内存空间分为<strong>栈(stack)</strong>、<strong>堆(heap)</strong>、<strong>池(一般也会归类为栈中)</strong>。 其中<strong>栈</strong>存放变量，<strong>堆</strong>存放复杂对象，<strong>池</strong>存放常量，所以也叫常量池。</p> <ul><li>基本类型：--&gt; <code>栈</code>内存（不包含闭包中的变量）</li> <li>引用类型：--&gt; <code>堆</code>内存</li></ul> <p><strong>注意</strong>闭包中的变量并不保存中栈内存中，而是保存在<code>堆内存</code>中，这也就解释了函数执行完之后为什么闭包还能引用到函数内的变量</p> <h3 id="_5-数据类型-赋值"><a href="#_5-数据类型-赋值" class="header-anchor">#</a> 5 数据类型---赋值</h3> <h2 id="_2-函数"><a href="#_2-函数" class="header-anchor">#</a> 2 函数</h2> <h3 id="_1-函数的定义"><a href="#_1-函数的定义" class="header-anchor">#</a> 1 函数的定义</h3> <ul><li>函数声明</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">函数名</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 函数体</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>函数表达式</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 函数体</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>备注</strong>：函数声明的时候，函数体并不会执行，只要当函数被调用的时候才会执行。</p> <h3 id="_2-函数声明与函数表达式的区别"><a href="#_2-函数声明与函数表达式的区别" class="header-anchor">#</a> 2 函数声明与函数表达式的区别</h3> <ul><li><p>函数声明必须有名字</p></li> <li><p>函数声明会函数提升，在预解析阶段就已创建，声明前后都可以调用</p></li> <li><p>函数表达式类似于变量赋值</p></li> <li><p>函数表达式可以没有名字，例如匿名函数</p></li> <li><p>函数表达式没有变量提升，在执行阶段创建，必须在表达式执行之后才可以调用</p> <h5 id="预解析"><a href="#预解析" class="header-anchor">#</a> 预解析</h5></li></ul> <p>**这里涉及到浏览器的预解析，浏览器解析代码之前，把变量的声明和函数的声明提前到作用域的最上面 **</p> <ul><li>尽量多用函数表达式，以免出错</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//变量的提升</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span>
<span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> 
<span class="token comment">//只是把变量的声明提前，赋值并未提前</span>
<span class="token comment">//相当于以下代码 </span>
<span class="token keyword">var</span> a<span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> 
<span class="token comment">//函数的声明提前了 </span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;函数执行了&quot;</span><span class="token punctuation">)</span><span class="token comment">//函数执行了 } </span>
<span class="token comment">//浏览器的预解析会将变量或函数的声明提前，并不会将赋值提前</span>
<span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">f2</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;函数执行了&quot;</span><span class="token punctuation">)</span><span class="token comment">//报错</span>
<span class="token punctuation">}</span> 
<span class="token comment">//相当于 </span>
<span class="token keyword">var</span> f2<span class="token punctuation">;</span>
<span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function-variable function">f2</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;函数执行了&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-this指向"><a href="#_3-this指向" class="header-anchor">#</a> 3 this指向</h3> <p>this是面向对象语言中 this 表示当前对象的一个引用。</p> <p>但在 JavaScript 中 this 不是固定不变的，它会随着执行环境的改变而改变。</p> <p>函数的调用方式决定了 <code>this</code> 指向的不同：</p> <table><thead><tr><th>调用方式</th> <th>非严格模式</th> <th>备注</th></tr></thead> <tbody><tr><td>普通函数调用</td> <td>window</td> <td>严格模式下是 undefined</td></tr> <tr><td>构造函数调用</td> <td>实例对象</td> <td>原型方法中 this 也是实例对象</td></tr> <tr><td>对象方法调用</td> <td>该方法所属对象</td> <td>紧挨着的对象</td></tr> <tr><td>事件绑定方法</td> <td>绑定事件对象</td> <td></td></tr> <tr><td>定时器函数</td> <td>window</td> <td></td></tr> <tr><td>call apply bind</td> <td>传入的对象</td> <td></td></tr> <tr><td>箭头函数中的this</td> <td>定义时的对象</td> <td></td></tr> <tr><td>vue中的this</td> <td></td> <td></td></tr></tbody></table> <p>**但是不管函数是按哪种方法来调用的，请记住一点：谁调用这个函数或方法,this关键字就指向谁 **</p> <h4 id="普通函数"><a href="#普通函数" class="header-anchor">#</a> 普通函数</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span>
</code></pre></div><h4 id="构造函数-对象-原型"><a href="#构造函数-对象-原型" class="header-anchor">#</a> 构造函数+对象+原型</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">// 构造函数</span>
       <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 对象的方法</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayHi</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token comment">// 原型中的方法</span>
       <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token keyword">var</span> per<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Person</span>
       per<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Person</span>
       per<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Person</span>

</code></pre></div><h4 id="定时器中的this"><a href="#定时器中的this" class="header-anchor">#</a> 定时器中的this</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//window</span>
</code></pre></div><h4 id="改变this指向"><a href="#改变this指向" class="header-anchor">#</a> 改变this指向</h4> <p>apply和call的使用方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>   <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:====&gt;&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是实例对象</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">var</span> per <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实例对象</span>
   <span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实例对象</span>
   <span class="token comment">//sayHi方法是per实例对象的</span>
   per<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>stu<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   per<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>stu<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <p>apply的使用语法</p> <ul><li>函数名字.apply(对象,[参数1,参数2,...]);</li> <li>方法名字.apply(对象,[参数1,参数2,...]);</li></ul> <p>call的使用语法</p> <ul><li>函数名字.call(对象,参数1,参数2,...);</li> <li>方法名字.call(对象,参数1,参数2,...)</li></ul> <p>作用:将函数或着方法中的this指向当前传入的对象，下面的例子中，将b对象传入call方法，此时A中的this就指向了对象b，此时的b对象中的a属性就被改变成1</p> <div class="language- extra-class"><pre class="language-text"><code>function A() {
            this.a = 1
        }
        var b={
            a:2
        }
        A.call(b)
        console.log(b.a)//1
</code></pre></div><p>不同的地方:参数传递的方式是不一样的,执行的性能不一样</p> <p>只要是想使用别的对象的方法,并且希望这个方法是当前对象的,那么就可以使用apply或者是call的方法改变this的指向</p> <p><strong>bind的使用</strong></p> <p>bind不会立即调用，而是返回一个函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> b
        <span class="token punctuation">}</span>

        <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token punctuation">{</span>
            d<span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>

        <span class="token function">a</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">a</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//将对象c传入bind方法，对象c就有a的属性b</span>
</code></pre></div><h3 id="_4-函数的调用"><a href="#_4-函数的调用" class="header-anchor">#</a> 4 函数的调用</h3> <ul><li>一般函数 : 直接调用</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 声明函数</span>
<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;吃了没？&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调用函数</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>构造函数 : 通过new调用，实例化对象时就通过new调用函数</p> <p>function F1() {
console.log(&quot;我是构造函数,我骄傲&quot;);
}
var f=new F1();</p></li> <li><p>对象 : 通过.调用内部的属性/方法</p> <p>function Person() {
this.play=function () {
console.log(&quot;玩代码&quot;);
};
}
var per=new Person();
per.play();</p></li> <li><p>call/apply调用//可以让一个函数成为任意对象的方法调用</p></li></ul> <h3 id="_5-函数的成员"><a href="#_5-函数的成员" class="header-anchor">#</a> 5 函数的成员</h3> <ul><li><p>函数中有一个name属性-----&gt;函数的名字,name属性是只读的,不能修改</p></li> <li><p>函数中有一个arguments属性---&gt;实参的个数</p></li> <li><p>函数中有一个length属性----&gt;函数定义的时候形参的个数</p></li> <li><p>函数中有一个caller属性----&gt;调用(f1函数在f2函数中调用的,所以,此时调用者就是f2)</p> <p>function f1(x,y) {
console.log(f1.name);
console.log(f1.arguments.length);
console.log(f1.length);
console.log(f1.caller);//调用者
}
function f2() {
console.log(&quot;f2函数的代码&quot;);
f1(1,2);
}
f2();</p></li></ul> <h3 id="_6-自调用函数"><a href="#_6-自调用函数" class="header-anchor">#</a> 6 自调用函数</h3> <div class="language- extra-class"><pre class="language-text"><code>(function(w, obj){
  //实现代码
})(window, obj)
</code></pre></div><ul><li><p>专业术语为: IIFE (Immediately Invoked Function Expression) 立即调用函数表达式</p></li> <li><p>作用：</p> <p>—隐藏内部实现</p> <p>—不污染外部命名空间</p> <p>—用它编写js模块</p></li></ul> <h3 id="_7-回调函数"><a href="#_7-回调函数" class="header-anchor">#</a> 7 回调函数</h3> <ul><li><p>什么函数才是回调函数?</p> <ul><li>你定义的</li> <li>你没有调用</li> <li>但它最终执行了(在一定条件下或某个时刻)</li></ul></li> <li><p>常用的回调函数</p> <ul><li>dom事件回调函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">//1. DOM事件函数</span>
  <span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>
  btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>定时器回调函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token comment">//2. 定时器函数</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'到点啦!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>ajax请求回调函数(后面讲解)</li> <li>生命周期回调函数(后面讲解)</li></ul></li></ul> <h2 id="_3-对象"><a href="#_3-对象" class="header-anchor">#</a> 3 对象</h2> <h3 id="_1-定义"><a href="#_1-定义" class="header-anchor">#</a> 1 定义</h3> <p><strong>(1) 对象是单个事物的抽象。</strong></p> <p>一本书、一辆汽车、一个人都可以是对象，一个数据库、一张网页、一个与远程服务器的连接也可以是对象。当实物被抽象成对象，实物之间的关系就变成了对象之间的关系，从而就可以模拟现实情况，针对对象进行编程。</p> <p><strong>(2) 对象是一个容器，封装了属性（property）和方法（method）。</strong></p> <p>属性是对象的状态，方法是对象的行为（完成某种任务）。比如，我们可以把动物抽象为animal对象，使用“属性”记录具体是那一种动物，使用“方法”表示动物的某种行为（奔跑、捕猎、休息等等）。</p> <p>在实际开发中，对象是一个抽象的概念，可以将其简单理解为：<strong>数据集或功能集</strong>。</p> <p>ECMAScript-262 把对象定义为：<strong>无序属性的集合，其属性可以包含基本值、对象或者函数</strong>。
严格来讲，这就相当于说对象是一组没有特定顺序的值。对象的每个属性或方法都有一个名字，而每个名字都
映射到一个值。</p> <h3 id="_2-对象的类型"><a href="#_2-对象的类型" class="header-anchor">#</a> 2 对象的类型</h3> <p>内建对象</p> <p>宿主对象</p> <p>自定义对象</p> <h3 id="_3-创建对象的方式"><a href="#_3-创建对象的方式" class="header-anchor">#</a> 3 创建对象的方式</h3> <p>####Object构造函数模式</p> <div class="language- extra-class"><pre class="language-text"><code>var obj = {};
obj.name = 'Tom'
obj.setName = function(name){this.name=name}
</code></pre></div><p>####<code>new Object()</code> 创建</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Jack'</span>
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>

person<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>####对象字面量模式</p> <div class="language- extra-class"><pre class="language-text"><code>var obj = {
  name : 'Tom',
  setName : function(name){this.name = name}
}
</code></pre></div><p>####工厂模式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//工厂模式创建对象</span>
<span class="token keyword">function</span> <span class="token function">createObject</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> obj<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;您好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">var</span> per2<span class="token operator">=</span><span class="token function">createObject</span><span class="token punctuation">(</span><span class="token string">&quot;小明&quot;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样封装确实爽多了，通过工厂模式我们解决了创建多个相似对象代码冗余的问题，
但却没有解决对象识别的问题（即怎样知道一个对象的类型）</p> <p>####构造函数模式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Jack</span>

<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>
p2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; Mike</span>

<span class="token keyword">new</span>一个对象的过程
<span class="token number">1.</span>声明一个中间对象
<span class="token number">2.</span>将该中间对象的proto指向构造函数的原型
<span class="token number">3.</span>将构造函数的<span class="token keyword">this</span>通过apply指向中间对象
<span class="token number">4.</span>返回该中间对象<span class="token punctuation">,</span>也就是返回了实例对象
</code></pre></div><p><strong>备注工厂模式和自定义构造函数模式的异同</strong></p> <p>/*
* 共同点:都是函数,都可以创建对象,都可以传入参数
* 区别
* 工厂模式:
* 函数名是小写
* 有new,
* 有返回值
* new之后的对象是当前的对象
* 直接调用函数就可以创建对象
*
* 自定义构造函数:
* 函数名是大写(首字母)
* 没有new
* 没有返回值
* this是当前的对象
* 通过new的方式来创建对象
* */</p> <p>####构造函数+原型的组合模式</p> <div class="language- extra-class"><pre class="language-text"><code>function Person(name, age) {
  this.name = name;
  this.age = age;
}
Person.prototype.setName = function(name){this.name=name;};
new Person('tom', 12);
</code></pre></div><h3 id="_4-new-关键字"><a href="#_4-new-关键字" class="header-anchor">#</a> 4  new 关键字</h3> <p>new关键字会调用创建的构造函数</p> <div class="language- extra-class"><pre class="language-text"><code>var obj  = {};
obj.__proto__ = F.prototype;
F.call(obj);
返回新的对象
</code></pre></div><p>第一行，我们创建了一个空对象obj;</p> <p>第二行，我们将这个空对象的__proto__成员指向了F函数对象prototype成员对象;</p> <p>第三行，我们将F函数对象的this指针替换成obj，然后再调用F函数.</p> <p>我们可以这么理解: 以 new 操作符调用构造函数的时候，函数内部实际上发生以下变化：</p> <p>1、创建一个空对象，并且 this 变量引用该对象，同时还继承了该函数的原型。</p> <p>2、属性和方法被加入到 this 引用的对象中。</p> <p>3、新创建的对象由 this 所引用，并且最后隐式的返回 this.</p> <p>作者：路易斯</p> <p>链接：https://juejin.im/post/58f94c9bb123db411953691b</p> <p>来源：掘金</p> <p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p> <h3 id="_5-遍历对象的属性"><a href="#_5-遍历对象的属性" class="header-anchor">#</a> 5 遍历对象的属性</h3> <blockquote><p>通过for..in语法可以遍历一个对象</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">&quot;==&quot;</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-删除对象的属性"><a href="#_6-删除对象的属性" class="header-anchor">#</a> 6 删除对象的属性</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'mm'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mm </span>
<span class="token keyword">delete</span> obj<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><h2 id="_4-原型"><a href="#_4-原型" class="header-anchor">#</a> 4 原型</h2> <p>Javascript 规定，每一个构造函数都有一个 <code>prototype</code> 属性，指向另一个对象。
这个对象的所有属性和方法，都会被构造函数的实例继承。</p> <p>这也就意味着，我们可以把所有对象实例需要共享的属性和方法直接定义在 <code>prototype</code> 对象上。</p> <ul><li>所有函数都有一个特别的属性:
<ul><li><code>prototype</code> : 显式原型属性</li></ul></li> <li>所有实例对象都有一个特别的属性:
<ul><li><code>__proto__</code> : 隐式原型属性</li></ul></li></ul> <h3 id="_1-原型的作用"><a href="#_1-原型的作用" class="header-anchor">#</a> 1 原型的作用</h3> <p>原型可以共享数据，节省内存空间</p> <ul><li>什么样子的数据是需要写在原型中?
<ul><li>需要共享的数据就可以写原型中</li> <li>原型的作用之一:数据共享</li></ul></li> <li>属性需要共享,方法也需要共享
<ul><li>不需要共享的数据写在构造函数中,需要共享的数据写在原型中</li></ul></li></ul> <h3 id="_2-构造函数-实例对象-原型对象-之间的关系"><a href="#_2-构造函数-实例对象-原型对象-之间的关系" class="header-anchor">#</a> 2 构造函数--实例对象--原型对象   之间的关系</h3> <p>构造函数可以实例化对象</p> <ul><li>构造函数中有一个属性叫prototype,是构造函数的原型对象</li> <li>构造函数的原型对象(prototype)中有一个constructor构造器,这个构造器指向的就是自己所在的原型对象所在的构造函数</li> <li>实例对象的原型对象(<strong>proto</strong>)指向的是该构造函数的原型对象</li> <li>构造函数的原型对象(prototype)中的方法是可以被实例对象直接访问的</li></ul> <p><img src="J:%5C%E5%89%8D%E7%AB%AF%E8%B5%84%E6%96%99%5C%E6%8A%80%E6%9C%AF%E6%96%87%E4%BB%B6%5Cjavascript%E7%AC%94%E8%AE%B0%5C%E6%88%91%E7%9A%84%E7%AC%94%E8%AE%B0%5Cpicture%5C%E4%B8%89%E8%80%85%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="三者之间的关系"></p> <h3 id="_3-原型中的方法可以相互调用"><a href="#_3-原型中的方法可以相互调用" class="header-anchor">#</a> 3 原型中的方法可以相互调用</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">=</span>name<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span>age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//原型中添加方法</span>
    <span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;动物吃东西&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">play</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;玩球&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sleep</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;睡觉了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> dog<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">&quot;小苏&quot;</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dog<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//原型对象中的方法,可以相互调用</span>
</code></pre></div><h3 id="_4-原型对象指向可以改变"><a href="#_4-原型对象指向可以改变" class="header-anchor">#</a> 4 原型对象指向可以改变</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">//人的构造函数</span>
    <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//人的原型对象方法</span>
    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;人的吃&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//学生的构造函数</span>
    <span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;嗨,小苏你好帅哦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//学生的原型,指向了一个人的实例对象</span>
    <span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> stu<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stu<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="J:%5C%E5%89%8D%E7%AB%AF%E8%B5%84%E6%96%99%5C%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B%5Cjavascript-%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%5C05-javascript%E9%AB%98%E7%BA%A7%5C3%5C01%E6%95%99%E5%AD%A6%E8%B5%84%E6%96%99%5C%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%8C%87%E5%90%91%E6%94%B9%E5%8F%98.png" alt="原型链指向改变"></p> <h3 id="_5-原型链"><a href="#_5-原型链" class="header-anchor">#</a> 5 原型链</h3> <p><strong>原型链:是一种关系,实例对象和原型对象之间的关系,关系是通过原型(<strong>proto</strong>)来联系的</strong></p> <p>每当代码读取某个对象的某个属性时，都会执行一次搜索，目标是具有给定名字的属性</p> <ul><li>搜索首先从对象实例本身开始</li> <li>如果在实例中找到了具有给定名字的属性，则返回该属性的值</li> <li>如果没有找到，则继续搜索指针指向的原型对象，在原型对象中查找具有给定名字的属性</li> <li>如果在原型对象中找到了这个属性，则返回该属性的值</li></ul> <p><strong>原型链的最终指向</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;吃东西&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> per<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//实例对象中有__proto__原型</span>
    <span class="token comment">//构造函数中有prototype原型</span>
    <span class="token comment">//prototype是对象</span>
    <span class="token comment">//所以,prototype这个对象中也有__proto__,那么指向了哪里</span>
    <span class="token comment">//实例对象中的__proto__指向的是构造函数的prototype</span>
    <span class="token comment">//所以,prototype这个对象中__proto__指向的应该是某个构造函数的原型prototype</span>

    <span class="token comment">//Person的prototype中的__proto__的指向</span>
    <span class="token comment">//console.log(Person.prototype.__proto__);</span>

    <span class="token comment">//per实例对象的__proto__-------&gt;Person.prototype的__proto__----&gt;Object.prototype的__proto__是null</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>per<span class="token punctuation">.</span>__proto__<span class="token operator">==</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>per<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token operator">==</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__<span class="token operator">==</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="J:%5C%E5%89%8D%E7%AB%AF%E8%B5%84%E6%96%99%5C%E6%8A%80%E6%9C%AF%E6%96%87%E4%BB%B6%5Cjavascript%E7%AC%94%E8%AE%B0%5C%E6%88%91%E7%9A%84%E7%AC%94%E8%AE%B0%5Cpicture%5C%E5%8E%9F%E5%9E%8B%E6%9C%80%E7%BB%88%E7%9A%84%E6%8C%87%E5%90%91.png" alt="原型最终的指向"></p> <h2 id="_5-继承"><a href="#_5-继承" class="header-anchor">#</a> 5 继承</h2> <p>面向对象编程思想:根据需求,分析对象,找到对象有什么特征和行为,通过代码的方式来实现需求,要想实现这个需求,就要创建对象,要想创建对象,就应该显示有构造函数,然后通过构造函数来创建对象.,通过对象调用属性和方法来实现相应的功能及需求,即可</p> <ul><li><p>首先JS不是一门面向对象的语言,JS是一门基于对象的语言,那么为什么学习js还要学习面向对象,因为面向对象的思想适合于人的想法,编程起来会更加的方便,及后期的维护....</p></li> <li><p>面向对象的编程语言中有类(class)的概念(也是一种特殊的数据类型),但是JS不是面向对象的语言,所以,JS中没有类(class),但是JS可以模拟面向对象的思想编程,JS中会通过构造函数来模拟类的概念(class)</p> <ul><li>面向对象的特性:封装,继承,多态</li> <li></li> <li>封装:就是包装</li> <li>一个值存储在一个变量中--封装</li> <li>一坨重复代码放在一个函数中--封装</li> <li>一系列的属性放在一个对象中--封装</li> <li>一些功能类似的函数(方法)放在一个对象中--封装</li> <li>好多相类似的对象放在一个js文件中---封装</li> <li></li> <li>继承: 首先继承是一种关系,类(class)与类之间的关系,JS中没有类,但是可以通过构造函数模拟类,然后通过原型来实现继承</li> <li>继承也是为了数据共享,js中的继承也是为了实现数据共享</li> <li></li> <li>原型作用之一:数据共享,节省内存空间</li> <li>原型作用之二:为了实现继承</li> <li></li> <li>继承是一种关系:</li> <li></li> <li>父类级别与类级别的关系</li></ul></li></ul> <h3 id="_1-通过原型继承"><a href="#_1-通过原型继承" class="header-anchor">#</a> 1 通过原型继承</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">age<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'吃饭'</span><span class="token punctuation">)</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">drink</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'喝水'</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">study</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>study <span class="token operator">=</span> study
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">habby</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打球'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'学习'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Student</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'语文'</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'数学'</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token number">1553092656449</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="F:%5C%E6%8A%80%E6%9C%AF%E6%96%87%E4%BB%B6%5Cjavascript%E7%AC%94%E8%AE%B0%5C%E6%88%91%E7%9A%84%E7%AC%94%E8%AE%B0%5Cpicture%5C%E5%8E%9F%E5%9E%8B%E7%BB%A7%E6%89%BF.png" alt="原型继承"></p> <p>这种方式实现的本质是通过将子类的原型指向了父类的实例，所以<strong>子类的实例就可以通过__proto__访问到 Student.prototype 也就是Person的实例，这样就可以访问到父类的私有方法，然后再通过__proto__指向父类的prototype就可以获得到父类原型上的方法</strong>。于是做到了将父类的私有、公有方法和属性都当做子类的公有属性</p> <p><strong>优点</strong></p> <ul><li>父类新增原型方法/原型属性，子类都能访问到</li> <li>简单，易于实现</li></ul> <p><strong>缺点</strong></p> <ul><li>无法实现多继承</li> <li>来自原型对象的所有属性被所有实例共享</li> <li>创建子类实例时，无法向父类构造函数传参</li> <li>要想为子类新增属性和方法，必须要在<code>Student.prototype = new Person()</code> 之后执行，不能放到构造器中</li></ul> <h3 id="_2-借用构造函数"><a href="#_2-借用构造函数" class="header-anchor">#</a> 2 借用构造函数</h3> <p>这种方式关键在于:<strong>在子类型构造函数中通用call()调用父类型构造函数</strong></p> <div class="language- extra-class"><pre class="language-text"><code>  function Person(name, age) {
    this.name = name,
    this.age = age,
    this.setName = function () {}
  }
  Person.prototype.setAge = function () {}
  function Student(name, age, price) {
    Person.call(this, name, age)  // 相当于: this.Person(name, age)
    /*this.name = name
    this.age = age*/
    this.price = price
  }
  var s1 = new Student('Tom', 20, 15000)
</code></pre></div><p><a href="https://camo.githubusercontent.com/f14aa910b41e399bf08bf24df6e691daa5f89a48/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f372f313636346461656634633164353262333f773d3130303126683d31333226663d706e6726733d3238323234" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/f14aa910b41e399bf08bf24df6e691daa5f89a48/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f372f313636346461656634633164353262333f773d3130303126683d31333226663d706e6726733d3238323234" alt="img"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
这种方式只是实现部分的继承，如果父类的原型还有方法和属性，子类是拿不到这些方法和属性的。</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(s1.setAge())//Uncaught TypeError: s1.setAge is not a function
</code></pre></div><p><strong>特点</strong>：</p> <ul><li>解决了原型链继承中子类实例共享父类引用属性的问题</li> <li>创建子类实例时，可以向父类传递参数</li> <li>可以实现多继承(call多个父类对象)</li></ul> <p><strong>缺点</strong>：</p> <ul><li>实例并不是父类的实例，只是子类的实例</li> <li>只能继承父类的实例属性和方法，不能继承原型属性和方法</li> <li>无法实现函数复用，每个子类都有父类实例函数的副本，影响性能</li></ul> <h3 id="_3-组合继承"><a href="#_3-组合继承" class="header-anchor">#</a> 3 组合继承</h3> <p>这种方式关键在于:<strong>通过调用父类构造，继承父类的属性并保留传参的优点，然后通过将父类实例作为子类原型，实现函数复用。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>function Person (name, age) {
  this.name = name,
  this.age = age,
  this.setAge = function () { }
}
Person.prototype.setAge = function () {
  console.log(&quot;111&quot;)
}
function Student (name, age, price) {
  Person.call(this, name, age)//第二次调用父类构造函数
  this.price = price
  this.setScore = function () { }
}
Student.prototype = new Person()//第一次调用父类构造函数
Student.prototype.constructor = Student//组合继承也是需要修复构造函数指向的
Student.prototype.sayHello = function () { }
var s1 = new Student('Tom', 20, 15000)
var s2 = new Student('Jack', 22, 14000)
console.log(s1)
console.log(s1.constructor) //Student
console.log(p1.constructor) //Person       
</code></pre></div><p><a href="https://camo.githubusercontent.com/bf4bb04dd685f54b7bb4495d9a29aa0a993bb14b/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f372f313636346536633062666336373238313f773d39383926683d33303926663d706e6726733d3334323338" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/bf4bb04dd685f54b7bb4495d9a29aa0a993bb14b/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f372f313636346536633062666336373238313f773d39383926683d33303926663d706e6726733d3334323338" alt="img"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
这种方式融合原型链继承和构造函数的优点，是 JavaScript 中最常用的继承模式。不过也存在缺点就是无论在什么情况下，都会调用两次构造函数：一次是在创建子类型原型的时候，另一次是在子类型构造函数的内部，子类型最终会包含父类型对象的全部实例属性，但我们不得不在调用子类构造函数时重写这些属性。</p> <p><strong>优点</strong>：</p> <ul><li>可以继承实例属性/方法，也可以继承原型属性/方法</li> <li>不存在引用属性共享问题</li> <li>可传参</li> <li>函数可复用</li></ul> <p><strong>缺点</strong>：</p> <ul><li>调用了两次父类构造函数，生成了两份实例</li></ul> <h3 id="_4"><a href="#_4" class="header-anchor">#</a> 4</h3> <p><strong>这种方式通过父类原型和子类原型指向同一对象，子类可以继承到父类的公有方法当做自己的公有方法，而且不会初始化两次实例方法/属性，避免的组合继承的缺点</strong>。</p> <div class="language- extra-class"><pre class="language-text"><code>function Person (name, age) {
  this.name = name,
  this.age = age,
  this.setAge = function () { }
}
Person.prototype.setAge = function () {
  console.log(&quot;111&quot;)
}
function Student (name, age, price) {
  Person.call(this, name, age)
  this.price = price
  this.setScore = function () { }
}
Student.prototype = Person.prototype
Student.prototype.sayHello = function () { }
var s1 = new Student('Tom', 20, 15000)
console.log(s1)       
</code></pre></div><p><a href="https://camo.githubusercontent.com/1662d8f5f75d7ce06bb000869747e3f401e5d6ba/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f382f313636353330393737643039643331633f773d37323626683d32323326663d706e6726733d3233343538" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/1662d8f5f75d7ce06bb000869747e3f401e5d6ba/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f382f313636353330393737643039643331633f773d37323626683d32323326663d706e6726733d3233343538" alt="img"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
但这种方式没办法辨别是对象是子类还是父类实例化</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(s1 instanceof Student, s1 instanceof Person)//true true
console.log(s1.constructor)//Person
</code></pre></div><p><strong>优点</strong>：</p> <ul><li>不会初始化两次实例方法/属性，避免的组合继承的缺点</li></ul> <p><strong>缺点</strong>：</p> <ul><li>没办法辨别是实例是子类还是父类创造的，子类和父类的构造函数指向是同一个。</li></ul> <h3 id="_5-寄生组合式继承"><a href="#_5-寄生组合式继承" class="header-anchor">#</a> 5 寄生组合式继承</h3> <p>**借助原型可以基于已有的对象来创建对象，var B = Object.create(A)以A对象为原型，生成了B对象。B继承了A的所有属性和方法。**使用<code>Object.create()</code>进行一次浅拷贝，将父类原型上的方法拷贝后赋给Student.prototype，这样子类上就能拥有了父类的共有方法，而且少了一次调用父类的构造函数。</p> <div class="language- extra-class"><pre class="language-text"><code>function Person (name, age) {
  this.name = name,
  this.age = age
}
Person.prototype.setAge = function () {
  console.log(&quot;111&quot;)
}
function Student (name, age, price) {
  Person.call(this, name, age)
  this.price = price
  this.setScore = function () { }
}
Student.prototype = Object.create(Person.prototype)//核心代码
Student.prototype.constructor = Student//核心代码
var s1 = new Student('Tom', 20, 15000)
console.log(s1 instanceof Student, s1 instanceof Person) // true true
console.log(s1.constructor) //Student
console.log(s1)       
</code></pre></div><p>同样的，Student继承了所有的Person原型对象的属性和方法。目前来说，最完美的继承方法！
<a href="https://camo.githubusercontent.com/d208000899c75a204a397d0fad7826fcd3eec98d/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f31312f313636363066616365333034306463363f773d36363826683d31383726663d706e6726733d3230333134" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/d208000899c75a204a397d0fad7826fcd3eec98d/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f31312f313636363066616365333034306463363f773d36363826683d31383726663d706e6726733d3230333134" alt="img"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_6-es6继承"><a href="#_6-es6继承" class="header-anchor">#</a> 6 Es6继承</h3> <p>ES6中引入了class关键字，class可以通过extends关键字实现继承，还可以通过static关键字定义类的静态方法,这比 ES5 的通过修改原型链实现继承，要清晰和方便很多。</p> <p>ES5 的继承，实质是先创造子类的实例对象this，然后再将父类的方法添加到this上面（Parent.apply(this)）。ES6 的继承机制完全不同，实质是先将父类实例对象的属性和方法，加到this上面（所以必须先调用super方法），然后再用子类的构造函数修改this。</p> <p><strong>需要注意的是，class关键字只是原型的语法糖，JavaScript继承仍然是基于原型实现的</strong>。</p> <div class="language- extra-class"><pre class="language-text"><code>class Person {
  //调用类的构造方法
  constructor(name, age) {
    this.name = name
    this.age = age
  }
  //定义一般的方法
  showName () {
    console.log(&quot;调用父类的方法&quot;)
    console.log(this.name, this.age);
  }
}
let p1 = new Person('kobe', 39)
console.log(p1)
//定义一个子类
class Student extends Person {
  constructor(name, age, salary) {
    super(name, age)//通过super调用父类的构造方法
    this.salary = salary
  }
  showName () {//在子类自身定义方法
    console.log(&quot;调用子类的方法&quot;)
    console.log(this.name, this.age, this.salary);
  }
}
let s1 = new Student('wade', 38, 1000000000)
console.log(s1)
s1.showName()     
</code></pre></div><p><a href="https://camo.githubusercontent.com/b523c13dfd9ef012d9f74df994105ebd9e866238/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f382f313636353337653636323733636264373f773d38353126683d33353926663d706e6726733d3434353439" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/b523c13dfd9ef012d9f74df994105ebd9e866238/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31302f382f313636353337653636323733636264373f773d38353126683d33353926663d706e6726733d3434353439" alt="img"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <strong>优点</strong>：</p> <ul><li>语法简单易懂,操作更方便</li></ul> <p><strong>缺点</strong>：</p> <ul><li>并不是所有的浏览器都支持class关键字</li></ul> <h3 id="_7-继承对比"><a href="#_7-继承对比" class="header-anchor">#</a> 7 继承对比</h3> <ul><li><p>class 声明会提升，但不会初始化赋值。Foo 进入暂时性死区，类似于 let、const 声明变量。</p></li> <li><p>class 声明内部会启用严格模式。</p></li> <li><p>class 的所有方法（包括静态方法和实例方法）都是不可枚举的。</p></li> <li><p>class 的所有方法（包括静态方法和实例方法）都没有原型对象 prototype，所以也没有[[construct]]，不能使用 new 来调用。</p></li> <li><p>必须使用 new 调用 class。</p></li> <li><p>class 内部无法重写类名。</p></li> <li><p>ES5:</p> <p>继承：ES5 的继承，实质是先创造子类的实例对象this，然后再将父类的方法添加到this上面（Parent.apply(this)）</p> <p>ES6:</p> <p>继承：</p> <p>1.子类没有自己的this对象，因此必须在construct中通过super继承父类的this对象，然后再用子类的构造函数修改this。不调用super，没有this对象，会报错</p></li></ul> <h2 id="_6-执行上下文"><a href="#_6-执行上下文" class="header-anchor">#</a> 6 执行上下文</h2> <h3 id="_1-执行上下文的类型"><a href="#_1-执行上下文的类型" class="header-anchor">#</a> 1 执行上下文的类型</h3> <p>执行上下文总共有三种类型</p> <ul><li><strong>全局执行上下文</strong>：
<ul><li>只有一个，在执行全局代码前将window确定为全局执行上下文</li> <li>对全局数据进行预处理
<ul><li>var定义的全局变量==&gt;undefined, 添加为window的属性</li> <li>function声明的全局函数==&gt;赋值(fun), 添加为window的方法</li> <li>this==&gt;赋值(window)</li></ul></li> <li>开始执行全局代码</li></ul></li> <li><strong>函数执行上下文</strong>：
<ul><li>存在无数个，在调用函数, 准备执行函数体之前, 创建对应的函数执行上下文对象</li> <li>对局部数据进行预处理
<ul><li>形参变量==&gt;赋值(实参)==&gt;添加为执行上下文的属性</li> <li>arguments==&gt;赋值(实参列表), 添加为执行上下文的属性</li> <li>var定义的局部变量==&gt;undefined, 添加为执行上下文的属性</li> <li>function声明的函数 ==&gt;赋值(fun), 添加为执行上下文的方法</li> <li>this==&gt;赋值(调用函数的对象)</li></ul></li> <li>开始执行函数体代码</li></ul></li> <li><strong>Eval 函数执行上下文</strong>： 指的是运行在 <code>eval</code> 函数中的代码，很少用而且不建议使用。</li></ul> <h3 id="_2-执行栈"><a href="#_2-执行栈" class="header-anchor">#</a> 2 执行栈</h3> <p>因为JS引擎创建了很多的执行上下文，所以JS引擎创建了执行上下文<strong>栈</strong>（Execution context stack，ECS）来<strong>管理</strong>执行上下文。</p> <p>当 JavaScript 初始化的时候会向执行上下文栈压入一个<strong>全局</strong>执行上下文，我们用 globalContext 表示它，并且只有当整个应用程序结束的时候，执行栈才会被清空，所以程序结束之前， 执行栈最底部永远有个 globalContext。</p> <p><strong>练习</strong></p> <ol><li>依次输出什么?</li> <li>整个过程中产生了几个执行上下文?</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global begin: '</span><span class="token operator">+</span> i<span class="token punctuation">)</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo() begin:'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo() end:'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global end: '</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>

</code></pre></div><p><img src="C:%5CUsers%5C%E5%93%88%E5%93%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1553179699291.png" alt="1553179699291"></p> <h3 id="_3-变量提升-函数提升"><a href="#_3-变量提升-函数提升" class="header-anchor">#</a> 3 变量提升-函数提升</h3> <p>例子一：<strong>变量提升</strong></p> <div class="language- extra-class"><pre class="language-text"><code>foo;  // undefined
var foo = function () {
    console.log('foo1');
}

foo();  // foo1，foo赋值

var foo = function () {
    console.log('foo2');
}

foo(); // foo2，foo重新赋值
</code></pre></div><p><strong>注意</strong></p> <p>使用var声明的变量会有提升，但是使用let和const声明的变量不会有提升</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//报错</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//报错</span>
<span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><p>例子二：<strong>函数提升</strong></p> <div class="language- extra-class"><pre class="language-text"><code>foo();  // foo2
function foo() {
    console.log('foo1');
}

foo();  // foo2

function foo() {
    console.log('foo2');
}

foo(); // foo2
</code></pre></div><p>例子三：声明优先级，<strong>函数 &gt; 变量</strong></p> <div class="language- extra-class"><pre class="language-text"><code>foo();  // foo2
var foo = function() {
    console.log('foo1');
}

foo();  // foo1，foo重新赋值

function foo() {
    console.log('foo2');
}

foo(); // foo1
</code></pre></div><p><strong>函数提升优先级比变量提升要高，且不会被变量声明覆盖，但是会被变量赋值覆盖</strong></p> <p>例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> foo<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// a  </span>
foo <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// b</span>
</code></pre></div><h2 id="_7-作用域"><a href="#_7-作用域" class="header-anchor">#</a> 7 作用域</h2> <ol><li>理解</li></ol> <ul><li>就是一块&quot;地盘&quot;, 一个代码段所在的区域</li> <li>它是静态的(相对于上下文对象), 在编写代码时就确定了</li></ul> <ol start="2"><li>分类</li></ol> <ul><li>全局作用域</li> <li>函数作用域</li> <li>没有块作用域(ES6有了)</li></ul> <ol start="3"><li>作用</li></ol> <ul><li>隔离变量，不同作用域下同名变量不会有冲突</li></ul> <p>###作用域链</p> <ol><li>理解</li></ol> <ul><li>多个上下级关系的作用域形成的链, 它的方向是从下向上的(从内到外)</li> <li>查找变量时就是沿着作用域链来查找的</li></ul> <ol start="2"><li>查找一个变量的查找规则</li></ol> <ul><li>在当前作用域下的执行上下文中查找对应的属性, 如果有直接返回, 否则进入2</li> <li>在上一级作用域的执行上下文中查找对应的属性, 如果有直接返回, 否则进入3</li> <li>再次执行2的相同操作, 直到全局作用域, 如果还找不到就抛出找不到的异常</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>思考</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">show</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span>
</code></pre></div><p>作用域在写代码时就确立了，不会改变</p> <h2 id="_8-闭包"><a href="#_8-闭包" class="header-anchor">#</a> 8 闭包</h2> <h3 id="_1-闭包的概念"><a href="#_1-闭包的概念" class="header-anchor">#</a> 1 闭包的概念</h3> <ol><li>如何产生闭包?</li></ol> <ul><li>当一个嵌套的内部(子)函数引用了嵌套的外部(父)函数的变量(函数)时, 就产生了闭包</li></ul> <ol start="2"><li>闭包到底是什么?</li></ol> <ul><li>使用chrome调试查看</li> <li>理解一: 闭包是嵌套的内部函数(绝大部分人)</li> <li>理解二: 包含被引用变量(函数)的对象(极少数人)</li> <li>注意: 闭包存在于嵌套的内部函数中</li></ul> <ol start="3"><li>产生闭包的条件?</li></ol> <ul><li>函数嵌套</li> <li>内部函数引用了外部函数的数据(变量/函数)</li></ul> <h3 id="_2-闭包的模式"><a href="#_2-闭包的模式" class="header-anchor">#</a> 2 闭包的模式</h3> <ul><li><p>函数模式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>对象模式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token keyword">function</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> num<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
     <span class="token keyword">var</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>
        age<span class="token operator">:</span>num
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//10</span>
    <span class="token punctuation">}</span>
    <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="_3-闭包的生命周期"><a href="#_3-闭包的生命周期" class="header-anchor">#</a> 3 闭包的生命周期</h3> <ul><li><p>产生: 在嵌套内部函数定义执行完时就产生了(不是在调用)</p></li> <li><p>死亡: 在嵌套的内部函数成为垃圾对象时</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//此处闭包已经产生</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      a<span class="token operator">++</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fun2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  f <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">//此时闭包对象死亡</span>
</code></pre></div><ul><li><p>在上面的这段代码中，在函数fun1中，由于函数声明的提升，在函数定义时就产生闭包，不需要调用函数。此时会将a变量数据缓存在闭包中，当fun1函数执行完之后，fun2函数对象不会消失，这是因为变量f指向fun2对象。所以当f=null之后，这个指向关系断开，fun2成为垃圾对象，会被浏览器的垃圾回收机制回收。</p> <p><strong>断点调试---代码执行过程</strong></p></li> <li><p><img src="C:%5CUsers%5C%E5%93%88%E5%93%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1553243719774.png" alt="1553243719774"></p></li></ul> <p><img src="C:%5CUsers%5C%E5%93%88%E5%93%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1553244218022.png" alt="1553244218022"></p> <h3 id="_4-闭包的作用"><a href="#_4-闭包的作用" class="header-anchor">#</a> 4 闭包的作用</h3> <ol><li><p>使用函数内部的变量在函数执行完后, 仍然存活在内存中(延长了局部变量的生命周期)</p></li> <li><p>可以定义js模块，设计私有的方法和变量,不会污染全局变量，将所有的数据和功能都封装在一个函数内部(私有的)，只向外暴露一个包含n个方法的对象或函数，只需要通过模块暴露的对象调用方法来实现对应的功能，jquery大量使用了闭包</p> <div class="language- extra-class"><pre class="language-text"><code>function module() {
	var arr = [];
	function add(val) {
		if (typeof val == 'number') {
			arr.push(val);
		}
	}
	function get(index) {
		if (index &lt; arr.length) {
			return arr[index]
		} else {
			return null;
		}
	}
	return {
		add: add,
		get: get
	}
}
var mod1 = module();
mod1.add(1);
mod1.add(2);
mod1.add('xxx');
console.log(mod1.get(2));
</code></pre></div></li></ol> <h3 id="_5-闭包的优缺点"><a href="#_5-闭包的优缺点" class="header-anchor">#</a> 5 闭包的优缺点</h3> <ul><li><p>优点：不会污染全局环境，实现属性私有化，方便模块化开发，减少形参的个数，延长形参的生命周期</p></li> <li><p>缺点：变量不会被清除，会被缓存下来，此时的变量是保存在堆中，大量使用闭包会造成内存泄露，在退出函数之前，将不使用的变量全部删除。</p></li></ul> <h3 id="_6-闭包思的this指向"><a href="#_6-闭包思的this指向" class="header-anchor">#</a> 6 闭包思的this指向</h3> <p>this指向调用时所处的环境，闭包中的this指向window</p> <p>思考题 1：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;The Window&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;My Object&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getNameFunc</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getNameFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//The window</span>
<span class="token comment">//这个题没有闭包，有函数嵌套，但是内部函数没有访问外部函数的变量。当object.getNameFunc()执行完后返回的是一个函数，当调用这个函数的时候，此时的this是window</span>
</code></pre></div><p>思考题 2：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;The Window&quot;</span><span class="token punctuation">;</span>　　
<span class="token keyword">var</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>　　　　
  name<span class="token operator">:</span> <span class="token string">&quot;My Object&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getNameFunc</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> that<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getNameFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// my object</span>
<span class="token comment">//产生闭包，object.getNameFunc()调用的时候，此时的this是指向object对象，将object对象赋值给that，此时that指向object，当调用返回后的函数时，此时指向的是that.name，即object的name属性</span>
</code></pre></div><p>思考题3：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
<span class="token comment">//如何输出123</span>
方法<span class="token number">1</span>：立即执行函数
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 0</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
方法<span class="token number">2</span>：返回一个匿名函数赋值
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 0</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 1</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 2</span>
无论是立即执行函数还是返回一个匿名函数赋值，原理上都是因为变量的按值传递，所以会将变量i的值复制给实参num，在匿名函数的内部又创建了一个用于访问num的匿名函数，这样每个函数都有了一个num的副本，互不影响了。

方法<span class="token number">3</span>：使用<span class="token constant">ES6</span>中的<span class="token keyword">let</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
解释下原理：

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 创建一个数组data;</span>

<span class="token comment">// 进入第一次循环</span>
<span class="token punctuation">{</span> 
	<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 注意：因为使用let使得for循环为块级作用域</span>
	           <span class="token comment">// 此次 let i = 0 在这个块级作用域中，而不是在全局环境中</span>
    data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
循环时，<span class="token keyword">let</span>声明i<span class="token punctuation">,</span>所以整个块是块级作用域，那么data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>这个函数就成了一个闭包。这里用｛｝表达并不符合语法，只是希望通过它来说明<span class="token keyword">let</span>存在时，这个<span class="token keyword">for</span>循环块是块级作用域，而不是全局作用域。

上面的块级作用域，就像函数作用域一样，函数执行完毕，其中的变量会被销毁，但是因为这个代码块中存在一个闭包，闭包的作用域链中引用着块级作用域，所以在闭包被调用之前，这个块级作用域内部的变量不会被销毁。

<span class="token comment">// 进入第二次循环</span>
<span class="token punctuation">{</span> 
	<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 因为 let i = 1 和上面的 let i = 0     </span>
	           <span class="token comment">// 在不同的作用域中，所以不会相互影响</span>
	data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
当执行data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>时，进入下面的执行环境。

<span class="token punctuation">{</span> 
     <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
     data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
在上面这个执行环境中，它会首先寻找该执行环境中是否存在i，没有找到，就沿着作用域链继续向上到了其所在的块作用域执行环境，找到了i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>于是输出了<span class="token number">1</span>。
</code></pre></div><h2 id="_9-内存溢出-内存泄露"><a href="#_9-内存溢出-内存泄露" class="header-anchor">#</a> 9 内存溢出-内存泄露</h2> <h3 id="_1-内存溢出"><a href="#_1-内存溢出" class="header-anchor">#</a> 1 内存溢出</h3> <ul><li>一种程序运行出现的错误</li> <li>当程序运行需要的内存超过了剩余的内存时, 就出抛出内存溢出的错误</li></ul> <p>###2 内存泄露</p> <ul><li>占用的内存没有及时释放</li> <li>内存泄露积累多了就容易导致内存溢出</li> <li>常见的内存泄露:
<ul><li>意外的全局变量
<ul><li>变量声明时忘记写var</li></ul></li> <li>没有及时清理的计时器或回调函数</li> <li>闭包</li></ul></li></ul> <h3 id="_3-垃圾回收机制"><a href="#_3-垃圾回收机制" class="header-anchor">#</a> 3 垃圾回收机制</h3> <p>JavaScript有自动垃圾收集机制，垃圾收集器会每隔一段时间就执行一次释放操作，找出那些不再继续使用的值，然后释放其占用的内存。</p> <ul><li>局部变量和全局变量的销毁
<ul><li><strong>局部变量</strong>：局部作用域中，当函数执行完毕，局部变量也就没有存在的必要了，因此垃圾收集器很容易做出判断并回收。</li> <li><strong>全局变量</strong>：全局变量什么时候需要自动释放内存空间则很难判断，所以在开发中尽量<strong>避免</strong>使用全局变量。</li></ul></li> <li>以Google的V8引擎为例，V8引擎中所有的JS对象都是通过堆来进行内存分配的
<ul><li><strong>初始分配</strong>：当声明变量并赋值时，V8引擎就会在堆内存中分配给这个变量。</li> <li><strong>继续申请</strong>：当已申请的内存不足以存储这个变量时，V8引擎就会继续申请内存，直到堆的大小达到了V8引擎的内存上限为止。</li></ul></li> <li>V8引擎对堆内存中的JS对象进行分代管理
<ul><li><strong>新生代</strong>：存活周期较短的JS对象，如临时变量、字符串等。</li> <li><strong>老生代</strong>：经过多次垃圾回收仍然存活，存活周期较长的对象，如主控制器、服务器对象等</li></ul></li></ul> <h4 id="垃圾回收算法"><a href="#垃圾回收算法" class="header-anchor">#</a> 垃圾回收算法</h4> <p>对垃圾回收算法来说，核心思想就是如何判断内存已经不再使用，常用垃圾回收算法有下面两种。</p> <ul><li>引用计数（现代浏览器不再使用）</li> <li>标记清除（常用）</li></ul> <h5 id="引用计数"><a href="#引用计数" class="header-anchor">#</a> 引用计数</h5> <p>引用计数算法定义“内存不再使用”的标准很简单，就是看一个对象是否有指向它的<strong>引用</strong>。如果没有其他对象指向它了，说明该对象已经不再需要了。</p> <div class="language- extra-class"><pre class="language-text"><code>// 创建一个对象person，他有两个指向属性age和name的引用
var person = {
    age: 12,
    name: 'aaaa'
};

person.name = null; // 虽然name设置为null，但因为person对象还有指向name的引用，因此name不会回收

var p = person; 
person = 1;         //原来的person对象被赋值为1，但因为有新引用p指向原person对象，因此它不会被回收

p = null;           //原person对象已经没有引用，很快会被回收
</code></pre></div><p>引用计数有一个致命的问题，那就是<strong>循环引用</strong></p> <p>如果两个对象相互引用，尽管他们已不再使用，但是垃圾回收器不会进行回收，最终可能会导致内存泄露。</p> <div class="language- extra-class"><pre class="language-text"><code>function cycle() {
    var o1 = {};
    var o2 = {};
    o1.a = o2;
    o2.a = o1; 

    return &quot;cycle reference!&quot;
}

cycle();
</code></pre></div><p><code>cycle</code>函数执行完成之后，对象<code>o1</code>和<code>o2</code>实际上已经不再需要了，但根据引用计数的原则，他们之间的相互引用依然存在，因此这部分内存不会被回收。所以现代浏览器<strong>不再使用</strong>这个算法。</p> <p>但是IE依旧使用。</p> <div class="language- extra-class"><pre class="language-text"><code>var div = document.createElement(&quot;div&quot;);
div.onclick = function() {
    console.log(&quot;click&quot;);
};
</code></pre></div><p>上面的写法很常见，但是上面的例子就是一个循环引用。</p> <p>变量div有事件处理函数的引用，同时事件处理函数也有div的引用，因为div变量可在函数内被访问，所以循环引用就出现了。</p> <h5 id="标记清除-常用"><a href="#标记清除-常用" class="header-anchor">#</a> 标记清除（常用）</h5> <p>标记清除算法将“不再使用的对象”定义为“<strong>无法到达的对象</strong>”。即从根部（在JS中就是全局对象）出发定时扫描内存中的对象，凡是能从根部到达的对象，<strong>保留</strong>。那些从根部出发无法触及到的对象被标记为<strong>不再使用</strong>，稍后进行回收。</p> <p>无法触及的对象包含了没有引用的对象这个概念，但反之未必成立。</p> <p>所以上面的例子就可以正确被垃圾回收处理了。</p> <p>所以现在对于主流浏览器来说，只需要切断需要回收的对象与根部的联系。最常见的内存泄露一般都与DOM元素绑定有关：</p> <div class="language- extra-class"><pre class="language-text"><code>email.message = document.createElement(“div”);
displayList.appendChild(email.message);

// 稍后从displayList中清除DOM元素
displayList.removeAllChildren();
</code></pre></div><p>上面代码中，<code>div</code>元素已经从DOM树中清除，但是该<code>div</code>元素还绑定在email对象中，所以如果email对象存在，那么该<code>div</code>元素就会一直保存在内存中。</p> <h4 id="内存泄漏"><a href="#内存泄漏" class="header-anchor">#</a> 内存泄漏</h4> <p>对于持续运行的服务进程（daemon），必须及时释放不再用到的内存。否则，内存占用越来越高，轻则影响系统性能，重则导致进程崩溃。 对于不再用到的内存，没有及时释放，就叫做内存泄漏（memory leak）</p> <h4 id="内存泄漏识别方法"><a href="#内存泄漏识别方法" class="header-anchor">#</a> 内存泄漏识别方法</h4> <h5 id="浏览器方法"><a href="#浏览器方法" class="header-anchor">#</a> 浏览器方法</h5> <ol><li>打开开发者工具，选择 Memory</li> <li>在右侧的Select profiling type字段里面勾选 timeline</li> <li>点击左上角的录制按钮。</li> <li>在页面上进行各种操作，模拟用户的使用情况。</li> <li>一段时间后，点击左上角的 stop 按钮，面板上就会显示这段时间的内存占用情况。</li></ol> <h5 id="命令行方法"><a href="#命令行方法" class="header-anchor">#</a> 命令行方法</h5> <p>使用 <code>Node</code> 提供的 <code>process.memoryUsage</code> 方法。</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(process.memoryUsage());

// 输出
{ 
  rss: 27709440,		// resident set size，所有内存占用，包括指令区和堆栈
  heapTotal: 5685248,   // &quot;堆&quot;占用的内存，包括用到的和没用到的
  heapUsed: 3449392,	// 用到的堆的部分
  external: 8772 		// V8 引擎内部的 C++ 对象占用的内存
}
</code></pre></div><p>判断内存泄漏，以<code>heapUsed</code>字段为准。</p> <h3 id="_4-常见的内存泄露的场景"><a href="#_4-常见的内存泄露的场景" class="header-anchor">#</a> 4 常见的内存泄露的场景</h3> <ul><li>缓存</li> <li>作用域未释放（闭包）</li> <li>没有必要的全局变量</li> <li>无效的DOM引用</li> <li>定时器未清除</li> <li>事件监听为空白</li></ul> <p><strong>内存泄露优化</strong></p> <ol><li>在业务不需要的用到的内部函数，可以重构到函数外，实现解除闭包。</li> <li>避免创建过多的生命周期较长的对象，或者将对象分解成多个子对象。</li> <li>避免过多使用闭包。</li> <li>注意清除定时器和事件监听器。</li> <li>nodejs中使用stream或buffer来操作大文件，不会受nodejs内存限制</li></ol> <h2 id="_10-js运行机制"><a href="#_10-js运行机制" class="header-anchor">#</a> 10 js运行机制</h2> <h3 id="_1-浏览器中的运行机制"><a href="#_1-浏览器中的运行机制" class="header-anchor">#</a> 1 浏览器中的运行机制</h3> <p>JavaScript是单线程，<strong>同一个时间只能做一件事</strong>。
JavaScript的单线程，主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</p> <h4 id="_1-1-任务队列"><a href="#_1-1-任务队列" class="header-anchor">#</a> <strong>1.1 任务队列</strong></h4> <p>avaScript所有任务分成两种，<strong>一种是同步任务（synchronous），另一种是异步任务（asynchronous）</strong>。同步任务指的是，在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；异步任务指的是，不进入主线程、而进入&quot;任务队列&quot;（task queue）的任务，只有&quot;任务队列&quot;通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。<strong>异步任务包括宏任务和微任务</strong></p> <p><img src="J:%5C%E5%89%8D%E7%AB%AF%E8%B5%84%E6%96%99%5C%E6%8A%80%E6%9C%AF%E6%96%87%E4%BB%B6%5Cjavascript%E7%AC%94%E8%AE%B0%5C%E6%88%91%E7%9A%84%E7%AC%94%E8%AE%B0%5Cpicture%5Cjs%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6.jpg" alt="js运行机制"></p> <h4 id="_1-2-理解event-loop"><a href="#_1-2-理解event-loop" class="header-anchor">#</a> 1.2 理解Event Loop</h4> <p><strong>异步执行的运行机制如下：</strong></p> <ol><li>所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。</li> <li>主线程之外，还存在一个&quot;任务队列&quot;（task queue）。只要异步任务有了运行结果，就在&quot;任务队列&quot;之中放置一个事件。</li> <li>一旦&quot;执行栈&quot;中的所有同步任务执行完毕，系统就会读取&quot;任务队列&quot;，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</li> <li>主线程不断重复上面的第三步。</li></ol> <p><strong>主线程从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）。只要主线程空了，就会去读取&quot;任务队列&quot;，这就是JavaScript的运行机制</strong>。这个过程会循环反复。</p> <h4 id="_1-3-异步任务队列及放入时机"><a href="#_1-3-异步任务队列及放入时机" class="header-anchor">#</a> 1.3 异步任务队列及放入时机</h4> <p>一般来说，有以下四种会放入异步任务队列：</p> <ol><li>setTimeout和setlnterval</li> <li>DOM事件</li> <li>ES6中的Promise</li> <li>Ajax异步请求</li></ol> <p><strong>javascript 代码运行分两个阶段</strong>：</p> <ul><li><p>预解析---把所有的函数定义提前，所有的变量声明提前，变量的赋值不提前</p></li> <li><p>执行---从上到下执行（按照js运行机制）</p></li></ul> <p>至于放入异步任务队列的时机，我们通过 setTimeout的例子</p> <div class="language- extra-class"><pre class="language-text"><code>例题1
for (var i = 0; i &lt; 5; i++) {
setTimeout(function() {  
 console.log(i);  
  }, 1000);
}
请问最后的输出结果是什么？
</code></pre></div><p>for循环一次碰到一个 setTimeout()，<strong>并不是马上把setTimeout()拿到异步队列中，而要等到一秒后，才将其放到任务队列里面</strong>，一旦&quot;执行栈&quot;中的所有同步任务执行完毕（即for循环结束，此时i已经为5），系统就会读取已经存放&quot;任务队列&quot;的setTimeout()（有五个），于是答案是输出5个5。</p> <p>上面也提到，<strong>在到达指定时间时，定时器就会将相应回调函数插入“任务队列”尾部。这就是“定时器（timer）”功能</strong>。</p> <h4 id="_1-4-微任务与宏任务"><a href="#_1-4-微任务与宏任务" class="header-anchor">#</a> <strong>1.4 微任务与宏任务</strong></h4> <p>我们上面提到异步任务分为宏任务和微任务，<strong>宏任务队列可以有多个，微任务队列只有一个</strong>。</p> <ul><li>宏任务包括：<strong>script(全局任务)</strong>, setTimeout, setInterval, setImmediate, I/O, UI rendering。</li> <li>微任务包括: new Promise().then(回调), process.nextTick, Object.observe(已废弃), MutationObserver(html5新特性)</li></ul> <p><strong>当执行栈中的所有同步任务执行完毕时，是先执行宏任务还是微任务呢？</strong></p> <ul><li>由于执行代码入口都是全局任务 script，而全局任务属于宏任务，所以当栈为空，同步任务任务执行完毕时，会先执行微任务队列里的任务。</li> <li>微任务队列里的任务全部执行完毕后，会读取宏任务队列中拍最前的任务。</li> <li>执行宏任务的过程中，遇到微任务，依次加入微任务队列。</li> <li>栈空后，再次读取微任务队列里的任务，依次类推。</li></ul> <p><img src="J:%5C%E5%89%8D%E7%AB%AF%E8%B5%84%E6%96%99%5C%E6%8A%80%E6%9C%AF%E6%96%87%E4%BB%B6%5C%E6%B5%8F%E8%A7%88%E5%99%A8%E8%80%83%E7%82%B9%5Cimage%5C%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.png" alt="事件循环"></p> <p>一句话概括上面的流程图：<strong>当某个宏任务队列的中的任务全部执行完以后,会查看是否有微任务队列。如果有，先执行微任务队列中的所有任务，如果没有，就查看是否有其他宏任务队列</strong>。</p> <p>接下来我们看两道例子来介绍上面流程：</p> <div class="language- extra-class"><pre class="language-text"><code>Promise.resolve().then(()=&gt;{
  console.log('Promise1')  
  setTimeout(()=&gt;{
    console.log('setTimeout2')
  },0)
})
setTimeout(()=&gt;{
  console.log('setTimeout1')
  Promise.resolve().then(()=&gt;{
    console.log('Promise2')    
  })
},0)
</code></pre></div><p>最后输出结果是Promise1，setTimeout1，Promise2，setTimeout2</p> <ul><li>一开始执行栈的同步任务执行完毕，会去查看是否有微任务队列，上题中存在(有且只有一个)，然后执行微任务队列中的所有任务输出Promise1，同时会生成一个宏任务 setTimeout2</li> <li>然后去查看宏任务队列，宏任务 setTimeout1 在 setTimeout2 之前，先执行宏任务 setTimeout1，输出 setTimeout1</li> <li>在执行宏任务setTimeout1时会生成微任务Promise2 ，放入微任务队列中，接着先去清空微任务队列中的所有任务，输出 Promise2</li> <li>清空完微任务队列中的所有任务后，就又会去宏任务队列取一个，这回执行的是 setTimeout2</li></ul> <div class="language- extra-class"><pre class="language-text"><code>console.log('----------------- start -----------------');
setTimeout(() =&gt; {
  console.log('setTimeout');
}, 0)
new Promise((resolve, reject) =&gt;{
  for (var i = 0; i &lt; 5; i++) {
    console.log(i);
  }
  resolve();  // 修改promise实例对象的状态为成功的状态
}).then(() =&gt; {
  console.log('promise实例成功回调执行');
})
console.log('----------------- end -----------------');
</code></pre></div><p><img src="C:%5CUsers%5C%E5%93%88%E5%93%88%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1554297002197.png" alt="1554297002197"></p> <p><strong>注意</strong>：promise实例创建后会立即执行里面的函数，new Promise应该是同步任务，执行then（）才是异步</p> <h4 id="_1-5面试题考察"><a href="#_1-5面试题考察" class="header-anchor">#</a> 1.5面试题考察</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>第一轮事件循环流程分析如下：</p> <ul><li>整体script作为第一个宏任务进入主线程，遇到<code>console.log</code>，输出1。</li> <li>遇到<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中。我们暂且记为<code>setTimeout1</code>。</li> <li>遇到<code>process.nextTick()</code>，其回调函数被分发到微任务Event Queue中。我们记为<code>process1</code>。</li> <li>遇到<code>Promise</code>，<code>new Promise</code>直接执行，输出7。<code>then</code>被分发到微任务Event Queue中。我们记为<code>then1</code>。</li> <li>又遇到了<code>setTimeout</code>，其回调函数被分发到宏任务Event Queue中，我们记为<code>setTimeout2</code>。</li></ul> <table><thead><tr><th>宏任务Event Queue</th> <th>微任务Event Queue</th></tr></thead> <tbody><tr><td>setTimeout1</td> <td>process1</td></tr> <tr><td>setTimeout2</td> <td>then1</td></tr></tbody></table> <ul><li>上表是第一轮事件循环宏任务结束时各Event Queue的情况，此时已经输出了1和7。</li> <li>我们发现了<code>process1</code>和<code>then1</code>两个微任务。</li> <li>执行<code>process1</code>,输出6。</li> <li>执行<code>then1</code>，输出8。</li></ul> <p>好了，第一轮事件循环正式结束，这一轮的结果是输出1，7，6，8。那么第二轮时间循环从<code>setTimeout1</code>宏任务开始：</p> <ul><li>首先输出2。接下来遇到了<code>process.nextTick()</code>，同样将其分发到微任务Event Queue中，记为<code>process2</code>。<code>new Promise</code>立即执行输出4，<code>then</code>也分发到微任务Event Queue中，记为<code>then2</code>。</li></ul> <table><thead><tr><th style="text-align:left;">宏任务Event Queue</th> <th>微任务Event Queue</th></tr></thead> <tbody><tr><td style="text-align:left;">setTimeout2</td> <td>process2</td></tr> <tr><td style="text-align:left;"></td> <td>then2</td></tr></tbody></table> <ul><li>第二轮事件循环宏任务结束，我们发现有<code>process2</code>和<code>then2</code>两个微任务可以执行。</li> <li>输出3。</li> <li>输出5。</li> <li>第二轮事件循环结束，第二轮输出2，4，3，5。</li> <li>第三轮事件循环开始，此时只剩setTimeout2了，执行。</li> <li>直接输出9。</li> <li>将<code>process.nextTick()</code>分发到微任务Event Queue中。记为<code>process3</code>。</li> <li>直接执行<code>new Promise</code>，输出11。</li> <li>将<code>then</code>分发到微任务Event Queue中，记为<code>then3</code>。</li></ul> <table><thead><tr><th>宏任务Event Queue</th> <th>微任务Event Queue</th></tr></thead> <tbody><tr><td></td> <td>process3</td></tr> <tr><td></td> <td>then3</td></tr></tbody></table> <ul><li>第三轮事件循环宏任务执行结束，执行两个微任务<code>process3</code>和<code>then3</code>。</li> <li>输出10。</li> <li>输出12。</li> <li>第三轮事件循环结束，第三轮输出9，11，10，12。</li></ul> <p>整段代码，共进行了三次事件循环，完整的输出为1，7，6，8，2，4，3，5，9，11，10，12。</p> <h3 id="_2-node-js中的event-loop"><a href="#_2-node-js中的event-loop" class="header-anchor">#</a> 2 node.js中的Event Loop</h3> <p>js的运行机制上面已讲述，在事件循环的时候，node与浏览器有所不同</p> <h2 id="_11-javascript设计模式"><a href="#_11-javascript设计模式" class="header-anchor">#</a> 11 javascript设计模式</h2> <h3 id="_11-1-观察着模式"><a href="#_11-1-观察着模式" class="header-anchor">#</a> 11.1 观察着模式</h3> <h3 id="_11-2-构造函数模式"><a href="#_11-2-构造函数模式" class="header-anchor">#</a> 11.2 构造函数模式</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 构造一个动物的函数 
 */</span>
<span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 实例一个对象</span>
<span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'猫'</span><span class="token punctuation">,</span> <span class="token string">'白色'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> cat<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_11-3-工厂模式"><a href="#_11-3-工厂模式" class="header-anchor">#</a> 11.3 工厂模式</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 工厂模式
 */</span>
<span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> opts<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>color <span class="token operator">=</span> opts<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function-variable function">getInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'名称：'</span><span class="token operator">+</span>obj<span class="token punctuation">.</span>name <span class="token operator">+</span><span class="token string">'， 颜色：'</span><span class="token operator">+</span> obj<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'波斯猫'</span><span class="token punctuation">,</span> color<span class="token operator">:</span> <span class="token string">'白色'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cat<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_11-4-单例模式"><a href="#_11-4-单例模式" class="header-anchor">#</a> 11.4 单例模式</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 在执行当前 Single 只获得唯一一个对象
 */</span>
<span class="token keyword">var</span> Single <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//define private methods and properties</span>
        <span class="token comment">//do something</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment">//define public methods and properties</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取实例</span>
        <span class="token function-variable function">getInstance</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span><span class="token punctuation">{</span>
                instance <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> Single<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> Single<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1 <span class="token operator">===</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_11-5-混合模式"><a href="#_11-5-混合模式" class="header-anchor">#</a> 11.5 混合模式</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 混合模式 = 原型模式 + 构造函数模式
 */</span>
<span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token operator">+</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'名称：'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">largeCat</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

largeCat<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">create</span> <span class="token punctuation">(</span><span class="token parameter">parentObj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> parentObj<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

largeCat<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getColor</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">largeCat</span><span class="token punctuation">(</span><span class="token string">&quot;Persian&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;白色&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> cat <span class="token punctuation">)</span>
</code></pre></div><h2 id="_12-js实现多线程"><a href="#_12-js实现多线程" class="header-anchor">#</a> 12 js实现多线程</h2> <h3 id="_12-1-概述"><a href="#_12-1-概述" class="header-anchor">#</a> 12.1 概述</h3> <p>Web Worker 的作用，就是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行。在主线程运行的同时，Worker 线程在后台运行，两者互不干扰。等到 Worker 线程完成计算任务，再把结果返回给主线程。这样的好处是，一些计算密集型或高延迟的任务，被 Worker 线程负担了，主线程（通常负责 UI 交互）就会很流畅，不会被阻塞或拖慢。</p> <p>Worker 线程一旦新建成功，就会始终运行，不会被主线程上的活动（比如用户点击按钮、提交表单）打断。这样有利于随时响应主线程的通信。但是，这也造成了 Worker 比较耗费资源，不应该过度使用，而且一旦使用完毕，就应该关闭。</p> <p>Web Worker 有以下几个使用注意点。</p> <p>（1）<strong>同源限制</strong></p> <p>分配给 Worker 线程运行的脚本文件，必须与主线程的脚本文件同源。</p> <p>（2）<strong>DOM 限制</strong></p> <p>Worker 线程所在的全局对象，与主线程不一样，无法读取主线程所在网页的 DOM 对象，也无法使用<code>document</code>、<code>window</code>、<code>parent</code>这些对象。但是，Worker 线程可以<code>navigator</code>对象和<code>location</code>对象。</p> <p>（3）<strong>通信联系</strong></p> <p>Worker 线程和主线程不在同一个上下文环境，它们不能直接通信，必须通过消息完成。</p> <p>（4）<strong>脚本限制</strong></p> <p>Worker 线程不能执行<code>alert()</code>方法和<code>confirm()</code>方法，但可以使用 XMLHttpRequest 对象发出 AJAX 请求。</p> <p>（5）<strong>文件限制</strong></p> <p>Worker 线程无法读取本地文件，即不能打开本机的文件系统（<code>file://</code>），它所加载的脚本，必须来自网络。</p> <h3 id="_12-2-用法"><a href="#_12-2-用法" class="header-anchor">#</a> 12.2 用法</h3> <h4 id="_1-主线程"><a href="#_1-主线程" class="header-anchor">#</a> 1 主线程</h4> <p>主线程采用<code>new</code>命令，调用<code>Worker()</code>构造函数，新建一个 Worker 线程。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'work.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p><code>Worker()</code>构造函数的参数是一个脚本文件，该文件就是 Worker 线程所要执行的任务。由于 Worker 不能读取本地文件，所以这个脚本必须来自网络。如果下载没有成功（比如404错误），Worker 就会默默地失败。</p> <p>然后，主线程调用<code>worker.postMessage()</code>方法，向 Worker 发消息。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>method<span class="token operator">:</span> <span class="token string">'echo'</span><span class="token punctuation">,</span> args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Work'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p><code>worker.postMessage()</code>方法的参数，就是主线程传给 Worker 的数据。它可以是各种数据类型，包括二进制数据。</p> <p>接着，主线程通过<code>worker.onmessage</code>指定监听函数，接收子线程发回来的消息。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received message '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 执行任务</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Work done!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>上面代码中，事件对象的<code>data</code>属性可以获取 Worker 发来的数据。</p> <p>Worker 完成任务以后，主线程就可以把它关掉。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h4 id="_2-worker线程"><a href="#_2-worker线程" class="header-anchor">#</a> 2 worker线程</h4> <p>Worker 线程内部需要有一个监听函数，监听<code>message</code>事件。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'You said: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>上面代码中，<code>self</code>代表子线程自身，即子线程的全局对象。因此，等同于下面两种写法。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 写法一</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'You said: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 写法二</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'You said: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>除了使用<code>self.addEventListener()</code>指定监听函数，也可以使用<code>self.onmessage</code>指定。监听函数的参数是一个事件对象，它的<code>data</code>属性包含主线程发来的数据。<code>self.postMessage()</code>方法用来向主线程发送消息。</p> <p>根据主线程发来的数据，Worker 线程可以调用不同的方法，下面是一个例子。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>cmd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'start'</span><span class="token operator">:</span>
      self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'WORKER STARTED: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'stop'</span><span class="token operator">:</span>
      self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'WORKER STOPPED: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Terminates the worker.</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Unknown command: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>上面代码中，<code>self.close()</code>用于在 Worker 内部关闭自身。</p> <h4 id="_3-worker加载脚本"><a href="#_3-worker加载脚本" class="header-anchor">#</a> 3 worker加载脚本</h4> <p>Worker 内部如果要加载其他脚本，有一个专门的方法<code>importScripts()</code>。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'script1.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>该方法可以同时加载多个脚本。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'script1.js'</span><span class="token punctuation">,</span> <span class="token string">'script2.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h4 id="_4-错误处理"><a href="#_4-错误处理" class="header-anchor">#</a> 4 错误处理</h4> <p>主线程可以监听 Worker 是否发生错误。如果发生错误，Worker 会触发主线程的<code>error</code>事件。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'ERROR: Line '</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>lineno<span class="token punctuation">,</span> <span class="token string">' in '</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token string">': '</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>message
  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者</span>
worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>Worker 内部也可以监听<code>error</code>事件。</p> <h4 id="_5-关闭worker"><a href="#_5-关闭worker" class="header-anchor">#</a> 5 关闭worker</h4> <p>使用完毕，为了节省系统资源，必须关闭 Worker。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker 线程</span>
self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h3 id="_12-3-数据通信"><a href="#_12-3-数据通信" class="header-anchor">#</a> 12.3 数据通信</h3> <p>前面说过，主线程与 Worker 之间的通信内容，可以是文本，也可以是对象。需要注意的是，这种通信是拷贝关系，即是传值而不是传址，Worker 对通信内容的修改，不会影响到主线程。事实上，浏览器内部的运行机制是，先将通信内容串行化，然后把串行化后的字符串发给 Worker，后者再将它还原。</p> <p>主线程与 Worker 之间也可以交换二进制数据，比如 File、Blob、ArrayBuffer 等类型，也可以在线程之间发送。下面是一个例子。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword">var</span> uInt8Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> uInt8Array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  uInt8Array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// [0, 2, 4, 6, 8,...]</span>
<span class="token punctuation">}</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>uInt8Array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker 线程</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> uInt8Array <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Inside worker.js: uInt8Array.toString() = '</span> <span class="token operator">+</span> uInt8Array<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Inside worker.js: uInt8Array.byteLength = '</span> <span class="token operator">+</span> uInt8Array<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>但是，拷贝方式发送二进制数据，会造成性能问题。比如，主线程向 Worker 发送一个 500MB 文件，默认情况下浏览器会生成一个原文件的拷贝。为了解决这个问题，JavaScript 允许主线程把二进制数据直接转移给子线程，但是一旦转移，主线程就无法再使用这些二进制数据了，这是为了防止出现多个线程同时修改数据的麻烦局面。这种转移数据的方法，叫做<a href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#transferable-objects" target="_blank" rel="noopener noreferrer">Transferable Objects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这使得主线程可以快速把数据交给 Worker，对于影像处理、声音处理、3D 运算等就非常方便了，不会产生性能负担。</p> <p>如果要直接转移数据的控制权，就要使用下面的写法。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Transferable Objects 格式</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">,</span> <span class="token punctuation">[</span>arrayBuffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 例子</span>
<span class="token keyword">var</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>ab<span class="token punctuation">,</span> <span class="token punctuation">[</span>ab<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h3 id="_12-4-同页面的-web-worker"><a href="#_12-4-同页面的-web-worker" class="header-anchor">#</a> 12.4 同页面的 Web Worker</h3> <p>通常情况下，Worker 载入的是一个单独的 JavaScript 脚本文件，但是也可以载入与主线程在同一个网页的代码。</p> <blockquote><div class="language-markup extra-class"><pre class="language-markup"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>worker<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app/worker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'some message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></blockquote> <p>上面是一段嵌入网页的脚本，注意必须指定<code>&lt;script&gt;</code>标签的<code>type</code>属性是一个浏览器不认识的值，上例是<code>app/worker</code>。</p> <p>然后，读取这一段嵌入页面的脚本，用 Worker 来处理。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#worker'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// e.data === 'some message'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>上面代码中，先将嵌入网页的脚本代码，转成一个二进制对象，然后为这个二进制对象生成 URL，再让 Worker 加载这个 URL。这样就做到了，主线程和 Worker 的代码都在同一个网页上面。</p> <h3 id="_12-5实例-worker-线程完成轮询"><a href="#_12-5实例-worker-线程完成轮询" class="header-anchor">#</a> 12.5实例：Worker 线程完成轮询</h3> <p>有时，浏览器需要轮询服务器状态，以便第一时间得知状态改变。这个工作可以放在 Worker 里面。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createWorker</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'('</span> <span class="token operator">+</span> f<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">')()'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> worker<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> pollingWorker <span class="token operator">=</span> <span class="token function">createWorker</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cache<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">new</span><span class="token punctuation">,</span> old</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/my-api-endpoint'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">compare</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cache <span class="token operator">=</span> data<span class="token punctuation">;</span>
        self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

pollingWorker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// render data</span>
<span class="token punctuation">}</span>

pollingWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>上面代码中，Worker 每秒钟轮询一次数据，然后跟缓存做比较。如果不一致，就说明服务端有了新的变化，因此就要通知主线程。</p> <h3 id="_12-6实例-worker-新建-worker"><a href="#_12-6实例-worker-新建-worker" class="header-anchor">#</a> 12.6实例： Worker 新建 Worker</h3> <p>Worker 线程内部还能再新建 Worker 线程（目前只有 Firefox 浏览器支持）。下面的例子是将一个计算密集的任务，分配到10个 Worker。</p> <p>主线程代码如下。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>Worker 线程代码如下。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// worker.js</span>

<span class="token comment">// settings</span>
<span class="token keyword">var</span> num_workers <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> items_per_worker <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>

<span class="token comment">// start the workers</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pending_workers <span class="token operator">=</span> num_workers<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num_workers<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'core.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>i <span class="token operator">*</span> items_per_worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> items_per_worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> storeResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// handle the results</span>
<span class="token keyword">function</span> <span class="token function">storeResult</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  result <span class="token operator">+=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  pending_workers <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pending_workers <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// finished!</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>上面代码中，Worker 线程内部新建了10个 Worker 线程，并且依次向这10个 Worker 发送消息，告知了计算的起点和终点。计算任务脚本的代码如下。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// core.js</span>
<span class="token keyword">var</span> start<span class="token punctuation">;</span>
onmessage <span class="token operator">=</span> getStart<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getStart</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  start <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  onmessage <span class="token operator">=</span> getEnd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> end<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  end <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  onmessage <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// perform some complex calculation here</span>
    result <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h3 id="_12-7api"><a href="#_12-7api" class="header-anchor">#</a> 12.7API</h3> <h4 id="_1-主线程-2"><a href="#_1-主线程-2" class="header-anchor">#</a> 1 主线程</h4> <p>浏览器原生提供<code>Worker()</code>构造函数，用来供主线程生成 Worker 线程。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>jsUrl<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p><code>Worker()</code>构造函数，可以接受两个参数。第一个参数是脚本的网址（必须遵守同源政策），该参数是必需的，且只能加载 JS 脚本，否则会报错。第二个参数是配置对象，该对象可选。它的一个作用就是指定 Worker 的名称，用来区分多个 Worker 线程。</p> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 主线程</span>
<span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name <span class="token operator">:</span> <span class="token string">'myWorker'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker 线程</span>
self<span class="token punctuation">.</span>name <span class="token comment">// myWorker</span>
</code></pre></div></blockquote> <p><code>Worker()</code>构造函数返回一个 Worker 线程对象，用来供主线程操作 Worker。Worker 线程对象的属性和方法如下。</p> <blockquote><ul><li>Worker.onerror：指定 error 事件的监听函数。</li> <li>Worker.onmessage：指定 message 事件的监听函数，发送过来的数据在<code>Event.data</code>属性中。</li> <li>Worker.onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。</li> <li>Worker.postMessage()：向 Worker 线程发送消息。</li> <li>Worker.terminate()：立即终止 Worker 线程。</li></ul></blockquote> <h4 id="_2-worker-线程"><a href="#_2-worker-线程" class="header-anchor">#</a> 2  Worker 线程</h4> <p>Web Worker 有自己的全局对象，不是主线程的<code>window</code>，而是一个专门为 Worker 定制的全局对象。因此定义在<code>window</code>上面的对象和方法不是全部都可以使用。</p> <p>Worker 线程有一些自己的全局属性和方法。</p> <blockquote><ul><li>self.name： Worker 的名字。该属性只读，由构造函数指定。</li> <li>self.onmessage：指定<code>message</code>事件的监听函数。</li> <li>self.onmessageerror：指定 messageerror 事件的监听函数。发送的数据无法序列化成字符串时，会触发这个事件。</li> <li>self.close()：关闭 Worker 线程。</li> <li>self.postMessage()：向产生这个 Worker 线程发送消息。</li> <li>self.importScripts()：加载 JS 脚本。</li></ul></blockquote> <h2 id="_13-深浅拷贝"><a href="#_13-深浅拷贝" class="header-anchor">#</a> 13 深浅拷贝</h2> <h3 id="_13-1-浅拷贝"><a href="#_13-1-浅拷贝" class="header-anchor">#</a> 13.1 浅拷贝</h3> <p>1.Object.assign()</p> <p>Object.assign() 方法可以把任意多个的源对象自身的可枚举属性拷贝给目标对象，然后返回目标对象</p> <p>2.Array.prototype.concat()</p> <p>3.Array.prototype.slice()</p> <h3 id="_13-2-深拷贝"><a href="#_13-2-深拷贝" class="header-anchor">#</a> 13.2 深拷贝</h3> <p>1.JSON.parse(JSON.stringify())</p> <p>原理： 用JSON.stringify将对象转成JSON字符串，再用JSON.parse()把字符串解析成对象，一去一来，新的对象产生了，而且对象会开辟新的栈，实现深拷贝。</p> <p><strong>这种方法虽然可以实现数组或对象深拷贝,但不能处理函数</strong></p> <div class="language- extra-class"><pre class="language-text"><code>let arr = [1, 3, {
    username: ' kobe'
},function(){}];
let arr4 = JSON.parse(JSON.stringify(arr));
arr4[2].username = 'duncan'; 
console.log(arr, arr4)
</code></pre></div><p><a href="https://camo.githubusercontent.com/cd2a62ed3493b2a43f1524ae8dc14a6c4ef18360/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f372f33302f313634653664616131346131663862653f773d34333826683d31313826663d706e6726733d3132313535" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/cd2a62ed3493b2a43f1524ae8dc14a6c4ef18360/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f372f33302f313634653664616131346131663862653f773d34333826683d31313826663d706e6726733d3132313535" alt="img"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
这是因为JSON.stringify() 方法是将一个JavaScript值(对象或者数组)转换为一个 JSON字符串，不能接受函数</p> <p>2 递归方法实现深度克隆原理：<strong>遍历对象、数组直到里边都是基本数据类型，然后再去复制，就是深度拷贝</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//定义检测数据类型的功能函数</span>
<span class="token keyword">function</span> <span class="token function">checkedType</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//实现深度克隆---对象/数组</span>
<span class="token keyword">function</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//判断拷贝的数据类型</span>
  <span class="token comment">//初始化变量result 成为最终克隆的数据</span>
  <span class="token keyword">let</span> result<span class="token punctuation">,</span>
    targetType <span class="token operator">=</span> <span class="token function">checkedType</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetType <span class="token operator">===</span> <span class="token string">'Object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>targetType <span class="token operator">===</span> <span class="token string">'Array'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target
  <span class="token punctuation">}</span>
  <span class="token comment">//遍历目标数据</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取遍历数据结构的每一项值。</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> target<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token comment">//判断目标结构里的每一值是否存在对象/数组</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkedType</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'Object'</span> <span class="token operator">||</span> <span class="token function">checkedType</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'Array'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//对象/数组里嵌套了对象/数组</span>
      <span class="token comment">//继续遍历获取到value值</span>
      result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//获取到value值是基本的数据类型或者是函数。</span>
      result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre></div><p>3.函数库lodash</p> <p>该函数库也有提供_.cloneDeep用来做 Deep Copy</p> <div class="language- extra-class"><pre class="language-text"><code>var _ = require('lodash');
var obj1 = {
    a: 1,
    b: { f: { g: 1 } },
    c: [1, 2, 3]
};
var obj2 = _.cloneDeep(obj1);
console.log(obj1.b.f === obj2.b.f);
// false
</code></pre></div><h2 id="_14-call-apply-bind"><a href="#_14-call-apply-bind" class="header-anchor">#</a> 14  call apply bind</h2> <h3 id="_14-1-call"><a href="#_14-1-call" class="header-anchor">#</a> 14.1 call()</h3> <p>call()方法用于改变this指向</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><p>通过上面的介绍我们知道，<code>call()</code>主要有以下两点</p> <ul><li>1、<code>call()</code>改变了this的指向</li> <li>2、函数 <code>bar</code> 执行了</li></ul> <p>实现方式</p> <ul><li>1、要先原型上即 Function.prototype上编程</li></ul> <ul><li>2、将函数设置为对象的属性：<code>foo.fn = bar</code></li> <li>3、执行函数：<code>foo.fn()</code></li> <li>4、删除函数：<code>delete foo.fn</code></li> <li>5、返回执行结果</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">call</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span> 
  context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_14-2-apply"><a href="#_14-2-apply" class="header-anchor">#</a> 14.2 apply</h3> <p>apply(obj,arr)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span> 
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  
    <span class="token keyword">let</span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_14-3-bind"><a href="#_14-3-bind" class="header-anchor">#</a> 14.3 bind()</h3> <p><code>bind</code> 方法与 <code>call / apply</code> 最大的不同就是bind返回一个绑定上下文的<strong>函数</strong>，而后两者是<strong>直接执行</strong>了函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
		value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
		name<span class="token operator">:</span> name<span class="token punctuation">,</span>
		age<span class="token operator">:</span> age
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接执行了函数</span>
<span class="token comment">// {value: 1, name: &quot;Jack&quot;, age: 20}</span>

<span class="token keyword">var</span> bindFoo1 <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个函数</span>
<span class="token function">bindFoo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {value: 1, name: &quot;Jack&quot;, age: 20}</span>

<span class="token keyword">var</span> bindFoo2 <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token string">&quot;Jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个函数</span>
<span class="token function">bindFoo2</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {value: 1, name: &quot;Jack&quot;, age: 20}</span>

</code></pre></div><p>通过上述代码可以看出bind 有如下特性：</p> <p>1、可以指定this
2、返回一个函数
3、可以传入参数
4、柯里化</p> <p>代码实现</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">fNOP</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> <span class="token function-variable function">fBound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> bindArgs <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">self</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">fNOP</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> context<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>bindArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    fNOP<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    fBound<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fNOP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fBound<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontEnd/frontBase/javascript/jsBase.html" class="prev">
        js基础
      </a></span> <span class="next"><a href="/frontEnd/frontBase/javascript/jsModule.html">
        模块机制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ed392c7e.js" defer></script><script src="/assets/js/2.e61ebc2f.js" defer></script><script src="/assets/js/17.65a246fc.js" defer></script>
  </body>
</html>
